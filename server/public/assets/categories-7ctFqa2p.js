import{h as J,r as p,b as X,i as D,j as e,B as l,C as Y,s as Z,t as ee,v as se,d as ae,c as f,K as ie,N as ne,O as re,P as te,Q as le,V as q,l as F,W as O,g as de}from"./index-DoMHCGG2.js";import{I as n}from"./input-COMsjQRu.js";import{L as i}from"./label-DSWK9Bhr.js";import{S as M}from"./switch-DKvoDZdm.js";import{D as S,b as T,c as P,d as L,e as E,f as k}from"./dialog-fsPDLJiu.js";import{T as ce,a as oe,b as Q,c as o,d as me,e as m}from"./table-I-YXpiuN.js";import{P as xe}from"./plus-B2are30l.js";import{S as he}from"./search-CdLD-xpV.js";import{P as ue}from"./panels-top-left-Bk9o9okL.js";import{E as pe}from"./ellipsis-vertical-CjI7CaMN.js";import{P as je}from"./pencil-w_OmdVc4.js";import{T as ve}from"./trash-2-Dn6YYs7e.js";function Te(){const{toast:x}=J(),[I,j]=p.useState(!1),[K,v]=p.useState(!1),[B,g]=p.useState(!1),[d,C]=p.useState(null),[a,h]=p.useState({name:"",nameAr:"",slug:"",description:"",descriptionAr:"",displayOrder:0,icon:"",active:!0}),[u,H]=p.useState(""),{data:y,isLoading:R}=X({queryKey:["/api/categories"],queryFn:de({})}),w=D({mutationFn:async s=>(await F("POST","/api/admin/categories",s)).json(),onSuccess:()=>{O.invalidateQueries({queryKey:["/api/categories"]}),j(!1),N(),x({title:"تم إنشاء التصنيف بنجاح"})},onError:s=>{x({title:"فشل إنشاء التصنيف",description:s.message,variant:"destructive"})}}),A=D({mutationFn:async s=>(await F("PUT",`/api/admin/categories/${s.id}`,s.data)).json(),onSuccess:()=>{O.invalidateQueries({queryKey:["/api/categories"]}),v(!1),N(),x({title:"تم تحديث التصنيف بنجاح"})},onError:s=>{x({title:"فشل تحديث التصنيف",description:s.message,variant:"destructive"})}}),b=D({mutationFn:async s=>{await F("DELETE",`/api/admin/categories/${s}`)},onSuccess:()=>{O.invalidateQueries({queryKey:["/api/categories"]}),g(!1),C(null),x({title:"تم حذف التصنيف بنجاح"})},onError:s=>{x({title:"فشل حذف التصنيف",description:s.message,variant:"destructive"})}}),N=()=>{h({name:"",nameAr:"",slug:"",description:"",descriptionAr:"",displayOrder:0,icon:"",active:!0})},r=s=>{const{name:t,value:U,type:W,checked:_}=s.target;h(G=>({...G,[t]:W==="checkbox"?_:U}))},$=()=>{if(a.name){const s=a.name.toLowerCase().replace(/[\s_]+/g,"-").replace(/[^\w\-]+/g,"").replace(/\-\-+/g,"-").trim();h(t=>({...t,slug:s}))}},V=s=>{C(s),h({name:s.name,nameAr:s.nameAr||"",slug:s.slug,description:s.description||"",descriptionAr:s.descriptionAr||"",displayOrder:s.displayOrder,icon:s.icon||"",active:s.active}),v(!0)},z=s=>{C(s),g(!0)},c=y==null?void 0:y.filter(s=>u?s.name.toLowerCase().includes(u.toLowerCase())||s.nameAr&&s.nameAr.includes(u)||s.slug.toLowerCase().includes(u.toLowerCase())||s.description&&s.description.toLowerCase().includes(u.toLowerCase()):!0);return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"التصنيفات"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة تصنيفات البطاقات والشهادات"})]}),e.jsxs(l,{onClick:()=>j(!0),children:[e.jsx(xe,{className:"h-4 w-4 ml-2"}),"إضافة تصنيف"]})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(he,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(n,{placeholder:"البحث في التصنيفات...",className:"pr-9",value:u,onChange:s=>H(s.target.value)})]})}),e.jsxs(Y,{children:[e.jsxs(Z,{className:"pb-3",children:[e.jsx(ee,{children:"التصنيفات"}),e.jsxs(se,{children:["عدد التصنيفات: ",(c==null?void 0:c.length)||0]})]}),e.jsx(ae,{children:R?e.jsx("div",{className:"flex justify-center py-10",children:e.jsx(f,{className:"h-8 w-8 animate-spin text-primary"})}):c!=null&&c.length?e.jsx("div",{className:"border rounded-md",children:e.jsxs(ce,{children:[e.jsx(oe,{children:e.jsxs(Q,{children:[e.jsx(o,{className:"w-12 text-center",children:"الأيقونة"}),e.jsx(o,{children:"الاسم"}),e.jsx(o,{children:"معرّف التصنيف"}),e.jsx(o,{className:"text-center",children:"الترتيب"}),e.jsx(o,{className:"text-center",children:"الحالة"}),e.jsx(o,{className:"text-center",children:"تاريخ الإنشاء"}),e.jsx(o,{className:"w-12"})]})}),e.jsx(me,{children:c.map(s=>e.jsxs(Q,{children:[e.jsx(m,{className:"text-center",children:s.icon?e.jsx("span",{className:"text-lg",children:s.icon}):e.jsx(ue,{className:"h-4 w-4 mx-auto text-muted-foreground"})}),e.jsxs(m,{children:[e.jsx("div",{className:"font-medium",children:s.name}),s.nameAr&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.nameAr})]}),e.jsx(m,{children:e.jsx("code",{className:"bg-muted text-sm px-1 py-0.5 rounded",children:s.slug})}),e.jsx(m,{className:"text-center",children:s.displayOrder}),e.jsx(m,{className:"text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.active?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"}`,children:s.active?"نشط":"غير نشط"})}),e.jsx(m,{className:"text-center",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx(m,{children:e.jsxs(ie,{children:[e.jsx(ne,{asChild:!0,children:e.jsx(l,{variant:"ghost",size:"icon",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(re,{align:"end",children:[e.jsx(te,{children:"خيارات"}),e.jsx(le,{}),e.jsxs(q,{onClick:()=>V(s),children:[e.jsx(je,{className:"h-4 w-4 ml-2"}),"تعديل"]}),e.jsxs(q,{onClick:()=>z(s),className:"text-destructive focus:text-destructive",children:[e.jsx(ve,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"لا توجد تصنيفات متاحة"})})]}),e.jsx(S,{open:I,onOpenChange:j,children:e.jsxs(T,{children:[e.jsxs(P,{children:[e.jsx(L,{children:"إضافة تصنيف جديد"}),e.jsx(E,{children:"أضف تصنيفًا جديدًا للبطاقات والشهادات."})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),w.mutate(a)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"name",children:"اسم التصنيف"}),e.jsx(n,{id:"name",name:"name",value:a.name,onChange:r,onBlur:$,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"nameAr",children:"الاسم بالعربية (اختياري)"}),e.jsx(n,{id:"nameAr",name:"nameAr",value:a.nameAr,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"slug",children:"معرّف التصنيف"}),e.jsx(n,{id:"slug",name:"slug",value:a.slug,onChange:r,required:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يجب أن يكون فريدًا وبدون مسافات"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"description",children:"الوصف (اختياري)"}),e.jsx(n,{id:"description",name:"description",value:a.description,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"descriptionAr",children:"الوصف بالعربية (اختياري)"}),e.jsx(n,{id:"descriptionAr",name:"descriptionAr",value:a.descriptionAr,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"icon",children:"الأيقونة (اختياري)"}),e.jsx(n,{id:"icon",name:"icon",value:a.icon,onChange:r,placeholder:"مثال: 📚"}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"يمكنك استخدام رمز تعبيري (Emoji)"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"displayOrder",children:"ترتيب العرض"}),e.jsx(n,{id:"displayOrder",name:"displayOrder",type:"number",min:"0",value:a.displayOrder,onChange:r,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(M,{id:"active",name:"active",checked:a.active,onCheckedChange:s=>h(t=>({...t,active:s}))}),e.jsx(i,{htmlFor:"active",children:"نشط"})]}),e.jsxs(k,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{j(!1),N()},children:"إلغاء"}),e.jsx(l,{type:"submit",disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الإضافة..."]}):"إضافة التصنيف"})]})]})]})}),e.jsx(S,{open:K,onOpenChange:v,children:e.jsxs(T,{children:[e.jsxs(P,{children:[e.jsx(L,{children:"تعديل التصنيف"}),e.jsx(E,{children:"تعديل بيانات التصنيف الحالي."})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),d&&A.mutate({id:d.id,data:a})},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-name",children:"اسم التصنيف"}),e.jsx(n,{id:"edit-name",name:"name",value:a.name,onChange:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-nameAr",children:"الاسم بالعربية (اختياري)"}),e.jsx(n,{id:"edit-nameAr",name:"nameAr",value:a.nameAr,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-slug",children:"معرّف التصنيف"}),e.jsx(n,{id:"edit-slug",name:"slug",value:a.slug,onChange:r,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-description",children:"الوصف (اختياري)"}),e.jsx(n,{id:"edit-description",name:"description",value:a.description,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-descriptionAr",children:"الوصف بالعربية (اختياري)"}),e.jsx(n,{id:"edit-descriptionAr",name:"descriptionAr",value:a.descriptionAr,onChange:r})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-icon",children:"الأيقونة (اختياري)"}),e.jsx(n,{id:"edit-icon",name:"icon",value:a.icon,onChange:r,placeholder:"مثال: 📚"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(i,{htmlFor:"edit-displayOrder",children:"ترتيب العرض"}),e.jsx(n,{id:"edit-displayOrder",name:"displayOrder",type:"number",min:"0",value:a.displayOrder,onChange:r,required:!0})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(M,{id:"edit-active",name:"active",checked:a.active,onCheckedChange:s=>h(t=>({...t,active:s}))}),e.jsx(i,{htmlFor:"edit-active",children:"نشط"})]}),e.jsxs(k,{children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>{v(!1),N()},children:"إلغاء"}),e.jsx(l,{type:"submit",disabled:A.isPending,children:A.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحديث..."]}):"تحديث"})]})]})]})}),e.jsx(S,{open:B,onOpenChange:g,children:e.jsxs(T,{children:[e.jsxs(P,{children:[e.jsx(L,{children:"حذف التصنيف"}),e.jsx(E,{children:"هل أنت متأكد من رغبتك في حذف هذا التصنيف؟ سيؤدي ذلك إلى حذف جميع القوالب والبطاقات المرتبطة به."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"font-medium",children:["التصنيف: ",d==null?void 0:d.name]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"لا يمكن التراجع عن هذا الإجراء."})]}),e.jsxs(k,{children:[e.jsx(l,{variant:"outline",onClick:()=>g(!1),children:"إلغاء"}),e.jsx(l,{variant:"destructive",onClick:()=>d&&b.mutate(d.id),disabled:b.isPending,children:b.isPending?e.jsxs(e.Fragment,{children:[e.jsx(f,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد الحذف"})]})]})})]})}export{Te as default};
