import{h as X,a as Z,r,b as ee,i as E,j as e,c as N,B as i,L as g,C as se,d as ae,K as te,N as le,O as ie,P as ne,Q as M,V as m,a6 as re,e as ce,M as oe,m as de,l as $,W as me,g as he}from"./index-DoMHCGG2.js";import{I as C}from"./input-COMsjQRu.js";import{D as F,b as O,c as Q,d as q,e as P,f as A}from"./dialog-fsPDLJiu.js";import{T as ue,a as xe,b as y,c as je}from"./tabs-CKJmMpcu.js";import{S as pe}from"./search-CdLD-xpV.js";import{E as fe}from"./ellipsis-vertical-CjI7CaMN.js";import{D as ge}from"./download-CkzZtpS5.js";import{C as U}from"./copy-DCUs-YoJ.js";import{S as ve}from"./share-2-C3FB-j83.js";import{T as we}from"./trash-2-Dn6YYs7e.js";function $e(){const{toast:d}=X();Z();const[h,B]=r.useState(""),[u,K]=r.useState("all"),[V,x]=r.useState(!1),[z,j]=r.useState(!1),[t,v]=r.useState(null),[Ne,b]=r.useState(!1),[D,S]=r.useState(!1),[p,I]=r.useState(""),{data:c,isLoading:R}=ee({queryKey:["/api/user/cards"],queryFn:he({on401:"redirect-to-login"})}),f=(c==null?void 0:c.cards)||[];c!=null&&c.total;const w=E({mutationFn:async s=>{await $("DELETE",`/api/cards/${s}`)},onSuccess:()=>{me.invalidateQueries({queryKey:["/api/user/cards"]}),j(!1),v(null),d({title:"تم حذف البطاقة بنجاح"})},onError:s=>{d({title:"فشل حذف البطاقة",description:s.message,variant:"destructive"})}}),H=E({mutationFn:async s=>(await $("POST","/api/cards/share-email",s)).json(),onSuccess:()=>{x(!1),I(""),d({title:"تم مشاركة البطاقة بنجاح",description:"تم إرسال البطاقة إلى البريد الإلكتروني المحدد"})},onError:s=>{d({title:"فشل مشاركة البطاقة",description:s.message,variant:"destructive"})}}),W=s=>{b(!0),de(s.imageUrl,`بطاقة_${s.id}.png`).finally(()=>{b(!1)})},T=s=>{const l=`${window.location.origin}/view/${s}`;navigator.clipboard.writeText(l),d({title:"تم نسخ الرابط",description:"تم نسخ رابط البطاقة إلى الحافظة"})},Y=s=>{v(s),x(!0)},_=s=>{v(s),j(!0)},L=f.filter(s=>{var n;const l=h?((n=s.template)==null?void 0:n.title)&&s.template.title.toLowerCase().includes(h.toLowerCase())||s.publicId&&s.publicId.toLowerCase().includes(h.toLowerCase()):!0,o=u==="all"||s.status===u;return l&&o}).reduce((s,l)=>{const o=new Date(l.createdAt),n=`${o.getMonth()}-${o.getFullYear()}`;return s[n]||(s[n]=[]),s[n].push(l),s},{});return R?e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"بطاقاتي"}),e.jsx("p",{className:"text-muted-foreground",children:"البطاقات التي قمت بإنشائها"})]}),e.jsx(i,{asChild:!0,children:e.jsx(g,{href:"/#templates",children:"إنشاء بطاقة جديدة"})})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(pe,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(C,{placeholder:"البحث في البطاقات...",className:"pr-9",value:h,onChange:s=>B(s.target.value)})]}),e.jsxs(ue,{value:u,onValueChange:K,children:[e.jsxs(xe,{children:[e.jsxs(y,{value:"all",children:["الكل (",f.length,")"]}),e.jsxs(y,{value:"active",children:["نشطة (",f.filter(s=>s.status==="active").length,")"]}),e.jsxs(y,{value:"draft",children:["مسودة (",f.filter(s=>s.status==="draft").length,")"]})]}),e.jsx(je,{value:u,className:"mt-6",children:Object.keys(L).length>0?e.jsx("div",{className:"space-y-8",children:Object.entries(L).map(([s,l])=>{const[o,n]=s.split("-").map(Number),G=new Date(n,o),J=new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long"}).format(G);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:J}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:l.map(a=>{var k;return e.jsxs(se,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video w-full overflow-hidden bg-muted",children:e.jsx("img",{src:a.imageUrl,alt:`بطاقة ${a.id}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),e.jsx(ae,{className:"p-4",children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:((k=a.template)==null?void 0:k.title)||`بطاقة ${a.id}`}),e.jsx("p",{className:"text-sm text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString("ar-SA")}),a.accessCount>0&&e.jsxs("p",{className:"text-xs text-muted-foreground mt-1",children:["عدد المشاهدات: ",a.accessCount]})]}),e.jsxs(te,{children:[e.jsx(le,{asChild:!0,children:e.jsx(i,{variant:"ghost",size:"icon",children:e.jsx(fe,{className:"h-4 w-4"})})}),e.jsxs(ie,{align:"end",children:[e.jsx(ne,{children:"خيارات"}),e.jsx(M,{}),e.jsx(m,{asChild:!0,children:e.jsxs(g,{href:`/view/${a.publicId}`,children:[e.jsx(re,{className:"h-4 w-4 ml-2"}),"عرض"]})}),e.jsxs(m,{onClick:()=>W(a),children:[e.jsx(ge,{className:"h-4 w-4 ml-2"}),"تحميل"]}),e.jsxs(m,{onClick:()=>T(a.publicId),children:[e.jsx(U,{className:"h-4 w-4 ml-2"}),"نسخ الرابط"]}),e.jsxs(m,{onClick:()=>Y(a),children:[e.jsx(ve,{className:"h-4 w-4 ml-2"}),"مشاركة"]}),e.jsx(M,{}),e.jsxs(m,{onClick:()=>_(a),className:"text-destructive focus:text-destructive",children:[e.jsx(we,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})]})}),e.jsx(ce,{className:"p-4 pt-0 flex justify-end",children:e.jsx(i,{variant:"outline",size:"sm",asChild:!0,children:e.jsx(g,{href:`/view/${a.publicId}`,children:"عرض البطاقة"})})})]},a.id)})})]},s)})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد بطاقات حتى الآن"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"قم بإنشاء بطاقة جديدة للبدء"}),e.jsx(i,{asChild:!0,children:e.jsx(g,{href:"/#templates",children:"إنشاء بطاقة جديدة"})})]})})]}),e.jsx(F,{open:V,onOpenChange:x,children:e.jsxs(O,{children:[e.jsxs(Q,{children:[e.jsx(q,{children:"مشاركة البطاقة"}),e.jsx(P,{children:"مشاركة البطاقة عبر البريد الإلكتروني أو وسائل التواصل الاجتماعي."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"رابط البطاقة"}),e.jsxs("div",{className:"flex",children:[e.jsx(C,{readOnly:!0,value:t?`${window.location.origin}/view/${t.publicId}`:"",className:"flex-1 ml-2"}),e.jsx(i,{variant:"outline",onClick:()=>t&&T(t.publicId),children:e.jsx(U,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsx("h3",{className:"font-medium",children:"مشاركة عبر البريد الإلكتروني"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(C,{placeholder:"أدخل البريد الإلكتروني للمستلم",type:"email",value:p,onChange:s=>I(s.target.value)}),e.jsx(i,{onClick:()=>{t&&p&&(S(!0),H.mutate({cardId:t.id,email:p},{onSettled:()=>S(!1)}))},disabled:!p||D,className:"w-full",children:D?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(oe,{className:"ml-2 h-4 w-4"}),"إرسال"]})})]})]})]}),e.jsx(A,{children:e.jsx(i,{variant:"outline",onClick:()=>x(!1),children:"إغلاق"})})]})}),e.jsx(F,{open:z,onOpenChange:j,children:e.jsxs(O,{children:[e.jsxs(Q,{children:[e.jsx(q,{children:"حذف البطاقة"}),e.jsx(P,{children:"هل أنت متأكد من رغبتك في حذف هذه البطاقة؟ هذا الإجراء لا يمكن التراجع عنه."})]}),e.jsxs("div",{className:"py-4",children:[t&&e.jsx("div",{className:"aspect-video w-[200px] h-[120px] mx-auto overflow-hidden rounded-md border",children:e.jsx("img",{src:t.imageUrl,alt:"البطاقة",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6 text-center",children:"سيتم حذف البطاقة نهائياً ولن تتمكن من استعادتها."})]}),e.jsxs(A,{children:[e.jsx(i,{variant:"outline",onClick:()=>j(!1),children:"إلغاء"}),e.jsx(i,{variant:"destructive",onClick:()=>t&&w.mutate(t.id),disabled:w.isPending,children:w.isPending?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد الحذف"})]})]})})]})}export{$e as default};
