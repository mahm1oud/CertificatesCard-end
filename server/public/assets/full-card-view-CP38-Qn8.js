import{o as z,a as U,u as $,h as B,r as l,b as F,j as e,B as t,L as c,C as d,d as n,c as H,s as b,t as C,m as P,g as Q}from"./index-DoMHCGG2.js";import{a as i,S as R}from"./share-options-Dq3pJXip.js";import{T as V,a as K,b as D,c as S}from"./tabs-CKJmMpcu.js";import{D as _,b as G,c as J,d as M,e as W}from"./dialog-fsPDLJiu.js";import{A as m}from"./arrow-left-BN8mgSLP.js";import{D as X}from"./download-CkzZtpS5.js";import{S as Y}from"./share-2-C3FB-j83.js";import"./scroll-area-BaWF6YIt.js";import"./index-BdQq_4o_.js";import"./image-CRCqvbIG.js";import"./twitter-BkFCnlyo.js";import"./instagram-BWPAtAad.js";import"./qr-code-BYf2XRjA.js";import"./copy-DCUs-YoJ.js";function ue(){var f,g,N,v,w,y;const{cardId:T}=z(),[Z,o]=U(),{user:x}=$();B();const[A,h]=l.useState(!1),[u,j]=l.useState(!1);l.useState(!1),l.useState(!1),l.useState("");const[k,L]=l.useState("preview"),{data:s,isLoading:q,error:E}=F({queryKey:[`/api/cards/public/${T}`],queryFn:Q({})});l.useEffect(()=>{s!=null&&s.id&&fetch(`/api/cards/${s.id}/view`,{method:"POST"}).catch(a=>console.error("Error registering view:",a))},[s==null?void 0:s.id]);const I=async()=>{var a;if(s){j(!0);try{await P(s.imageUrl,`بطاقة_${((a=s.template)==null?void 0:a.title)||s.id}.png`)}catch(r){console.error("Error downloading image:",r)}finally{j(!1)}}},p=a=>a?new Date(a).toLocaleDateString("ar-SA"):"غير متوفر",O=()=>{var a;x&&((a=s==null?void 0:s.user)==null?void 0:a.id)===x.id?o("/user/cards"):o("/")};return q?e.jsxs("div",{className:"container mx-auto py-10 max-w-5xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>window.history.back(),children:[e.jsx(m,{className:"h-4 w-4 ml-2"}),"العودة"]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-8",children:[e.jsx("div",{className:"w-full md:w-2/3",children:e.jsx(i,{className:"w-full aspect-[3/4] rounded-md"})}),e.jsxs("div",{className:"w-full md:w-1/3 space-y-4",children:[e.jsx(i,{className:"h-10 w-3/4"}),e.jsx(i,{className:"h-4 w-1/2"}),e.jsx(i,{className:"h-4 w-full"}),e.jsx(i,{className:"h-4 w-full"}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse mt-6",children:[e.jsx(i,{className:"h-10 w-24"}),e.jsx(i,{className:"h-10 w-24"})]})]})]})]}):E||!s?e.jsxs("div",{className:"container mx-auto py-10 max-w-5xl",children:[e.jsx("div",{className:"mb-6",children:e.jsx(t,{variant:"outline",size:"sm",asChild:!0,children:e.jsxs(c,{href:"/",children:[e.jsx(m,{className:"h-4 w-4 ml-2"}),"العودة للرئيسية"]})})}),e.jsx(d,{className:"text-center py-16",children:e.jsxs(n,{children:[e.jsx("h2",{className:"text-2xl font-bold mb-2",children:"لم نتمكن من العثور على البطاقة"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"قد تكون البطاقة غير موجودة أو تم حذفها"}),e.jsx(t,{asChild:!0,children:e.jsx(c,{href:"/",children:"العودة للصفحة الرئيسية"})})]})})]}):e.jsxs("div",{className:"container mx-auto py-6 md:py-10 max-w-6xl",children:[e.jsx("div",{className:"mb-6",children:e.jsxs(t,{variant:"outline",size:"sm",onClick:O,children:[e.jsx(m,{className:"h-4 w-4 ml-2"}),"العودة"]})}),e.jsxs(V,{value:k,onValueChange:L,className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs(K,{children:[e.jsx(D,{value:"preview",children:"عرض البطاقة"}),e.jsx(D,{value:"details",children:"تفاصيل البطاقة"})]}),e.jsxs("div",{className:"flex space-x-2 space-x-reverse",children:[e.jsxs(t,{variant:"outline",size:"sm",onClick:I,disabled:u,children:[u?e.jsx(H,{className:"h-4 w-4 ml-2 animate-spin"}):e.jsx(X,{className:"h-4 w-4 ml-2"}),"تحميل البطاقة"]}),e.jsxs(t,{variant:"outline",size:"sm",onClick:()=>h(!0),children:[e.jsx(Y,{className:"h-4 w-4 ml-2"}),"مشاركة"]})]})]}),e.jsx(S,{value:"preview",className:"m-0",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("div",{className:"max-w-xl w-full overflow-hidden rounded-lg shadow-lg bg-gray-50",children:e.jsx("img",{src:s.imageUrl,alt:((f=s.template)==null?void 0:f.title)||"بطاقة",className:"w-full h-auto object-contain mx-auto max-h-[85vh]",style:{aspectRatio:"3/4"},loading:"lazy",onError:a=>{console.error("Error loading image:",a),a.currentTarget.src="/placeholder-card.png"}})})})}),e.jsx(S,{value:"details",className:"m-0",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[e.jsxs(d,{className:"md:col-span-2",children:[e.jsx(b,{children:e.jsx(C,{children:"تفاصيل البطاقة"})}),e.jsxs(n,{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"العنوان"}),e.jsx("p",{className:"font-medium",children:((g=s.template)==null?void 0:g.title)||"بطاقة بدون عنوان"})]}),((N=s.template)==null?void 0:N.titleAr)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"العنوان بالعربية"}),e.jsx("p",{className:"font-medium",children:s.template.titleAr})]}),((v=s.template)==null?void 0:v.category)&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"التصنيف"}),e.jsx("p",{children:s.template.category.name})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"تاريخ الإنشاء"}),e.jsx("p",{children:p(s.createdAt)})]}),s.updatedAt&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"آخر تحديث"}),e.jsx("p",{children:p(s.updatedAt)})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"عدد المشاهدات"}),e.jsx("p",{children:s.accessCount})]}),s.quality&&e.jsxs("div",{children:[e.jsx("h4",{className:"text-sm font-medium text-muted-foreground mb-1",children:"الجودة"}),e.jsx("p",{children:s.quality==="high"?"عالية":s.quality==="medium"?"متوسطة":s.quality==="low"?"منخفضة":s.quality})]})]}),Object.keys(s.formData||{}).length>0&&e.jsxs("div",{className:"mt-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-2",children:"بيانات البطاقة"}),e.jsx("div",{className:"bg-muted p-3 rounded-md space-y-2",children:Object.entries(s.formData).map(([a,r])=>e.jsxs("div",{children:[e.jsx("h4",{className:"text-xs font-medium",children:a}),e.jsx("p",{className:"text-sm",children:String(r)})]},a))})]})]})]}),e.jsx("div",{className:"space-y-4",children:s.template&&e.jsxs(d,{children:[e.jsx(b,{children:e.jsx(C,{children:"بطاقات مشابهة"})}),e.jsx(n,{children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"استكشف المزيد من البطاقات في نفس التصنيف"}),e.jsx(t,{asChild:!0,className:"w-full",children:e.jsx(c,{href:`/?category=${((w=s.template.category)==null?void 0:w.slug)||""}`,children:"عرض المزيد من البطاقات"})})]})})]})})]})})]}),e.jsx(_,{open:A,onOpenChange:h,children:e.jsxs(G,{className:"max-w-md",children:[e.jsxs(J,{children:[e.jsx(M,{children:"مشاركة البطاقة"}),e.jsx(W,{children:"شارك هذه البطاقة مع العائلة والأصدقاء"})]}),e.jsx(R,{cardId:s.publicId,imageUrl:s.imageUrl,templateId:(y=s.template)==null?void 0:y.id})]})})]})}export{ue as default};
