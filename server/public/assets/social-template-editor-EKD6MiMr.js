import{r as j,j as e,G as Be,b as ve,l as ce,a7 as Ue,h as Ze,i as Ke,C as ke,s as Ie,t as ze,B as R,d as Te,m as Ye,E as Ce}from"./index-DoMHCGG2.js";import{T as qe,a as Je,b as Ee,c as Me}from"./tabs-CKJmMpcu.js";import{I as re}from"./input-COMsjQRu.js";import{L as k}from"./label-DSWK9Bhr.js";import{S as ue,a as ge,b as fe,c as ye,d as B}from"./select-CRu623qS.js";import{S as U}from"./slider-ef3OeGSW.js";import{S as je}from"./switch-DKvoDZdm.js";import{S as We,L as De,I as $e,b as ee,a as Xe,T as Le,R as _e}from"./ReactKonvaCore-0IBzjN_D.js";import{Z as Qe,a as et,E as Re}from"./zoom-out-eiDS2u6d.js";import{D as Ge}from"./download-CkzZtpS5.js";import{C as Ve}from"./copy-DCUs-YoJ.js";import{T as tt}from"./trash-2-Dn6YYs7e.js";import{M as st,a as it}from"./move-up-DPWnyieo.js";import{E as He}from"./eye-Co1cENxs.js";import{S as at}from"./save-CRRscGsZ.js";import{L as nt}from"./layers-D3_CD2xn.js";import{T as rt}from"./type-DWs-uHqd.js";import{I as lt}from"./image-CRCqvbIG.js";import{I as ot}from"./instagram-BWPAtAad.js";import{F as dt,T as ct}from"./twitter-BkFCnlyo.js";import{L as ht}from"./linkedin-BAwJMvZa.js";import"./index-BdQq_4o_.js";import"./chevron-up-DgjV3eGa.js";const le=1e3,xt=({templateImage:V,fields:g,onFieldsChange:r,editorSettings:y,className:X})=>{var be,Ne;const O=j.useRef(null),I=j.useRef(null),$=j.useRef(null),[G,Z]=j.useState(null),[o,te]=j.useState({width:800,height:600}),[v,z]=j.useState(1),[w,_]=j.useState({x:0,y:0}),[f,K]=j.useState({}),[p,x]=j.useState([]),[n,u]=j.useState([]),[C,L]=j.useState([]),[Y,oe]=j.useState((y==null?void 0:y.gridEnabled)!==void 0?y.gridEnabled:!0),W=(y==null?void 0:y.gridSize)||50,Q=(y==null?void 0:y.snapThreshold)||10,se=(y==null?void 0:y.gridEnabled)!==void 0?y.gridEnabled:!0,A=(y==null?void 0:y.snapToGrid)!==void 0?y.snapToGrid:!0;j.useEffect(()=>{const t=new window.Image;t.crossOrigin="anonymous",t.onload=()=>{if(console.log(`تم تحميل صورة القالب بأبعاد: ${t.width}x${t.height}`),Z(t),te({width:t.naturalWidth,height:t.naturalHeight}),O.current){const s=O.current.clientWidth,a=O.current.clientHeight||600,l=s/t.naturalWidth,d=a/t.naturalHeight,h=Math.min(l,d,1);console.log(`مقياس العرض: ${l.toFixed(2)}, مقياس الارتفاع: ${d.toFixed(2)}, المقياس المختار: ${h.toFixed(2)}`),z(h)}},t.src=V,t.onerror=s=>{console.error("فشل تحميل صورة القالب:",s)}},[V]),j.useEffect(()=>{const t=s=>{if(s.ctrlKey&&s.key==="z"){s.preventDefault(),i();return}if(s.ctrlKey&&s.key==="y"){s.preventDefault(),b();return}const a=s.shiftKey?10:1;let l=0,d=0;s.key==="ArrowLeft"&&(l=-a),s.key==="ArrowRight"&&(l=a),s.key==="ArrowUp"&&(d=-a),s.key==="ArrowDown"&&(d=a),s.ctrlKey?_(h=>({x:h.x+l,y:h.y+d})):p.length>0&&(l!==0||d!==0)&&(s.preventDefault(),D(l,d)),s.key==="+"&&z(h=>Math.min(h+.1,4)),s.key==="-"&&z(h=>Math.max(h-.1,.2)),(s.key==="Delete"||s.key==="Backspace")&&p.length>0&&(s.preventDefault(),ie()),s.ctrlKey&&s.key==="c"&&p.length>0&&(s.preventDefault(),we())};return window.addEventListener("keydown",t),()=>window.removeEventListener("keydown",t)},[p,g]);const H=t=>{const s=t.position.x/100*o.width,a=t.position.y/100*o.height;return{x:s,y:a}},m=()=>{u(t=>[...t,JSON.parse(JSON.stringify(g))]),L([])},i=()=>{if(n.length===0)return;const t=n[n.length-1];u(s=>s.slice(0,-1)),L(s=>[g,...s]),r(t)},b=()=>{if(C.length===0)return;const t=C[0];L(s=>s.slice(1)),u(s=>[...s,JSON.parse(JSON.stringify(g))]),r(t)},E=t=>{const s=[];for(let a=0;a<=o.width;a+=W)s.push({x:a,type:"grid"});for(let a=0;a<=o.height;a+=W)s.push({y:a,type:"grid"});return s.push({x:o.width/2,type:"center"}),s.push({y:o.height/2,type:"center"}),g.forEach(a=>{const l=H(a),d=a.style||{};if(s.push({x:l.x,type:"field",fieldId:a.id}),s.push({y:l.y,type:"field",fieldId:a.id}),a.type==="text"){(d.fontSize||24)*(o.width/le);const h=(d.width||200)*(o.width/le);d.align==="center"?(s.push({x:l.x-h/2,type:"field-edge",fieldId:a.id}),s.push({x:l.x+h/2,type:"field-edge",fieldId:a.id})):d.align==="left"?(s.push({x:l.x,type:"field-edge",fieldId:a.id}),s.push({x:l.x+h,type:"field-edge",fieldId:a.id})):(s.push({x:l.x-h,type:"field-edge",fieldId:a.id}),s.push({x:l.x,type:"field-edge",fieldId:a.id}))}else if(a.type==="image"){const h=d.imageMaxWidth||Math.round(o.width/4),F=d.imageMaxHeight||Math.round(o.height/4);s.push({x:l.x-h/2,type:"field-edge",fieldId:a.id}),s.push({x:l.x+h/2,type:"field-edge",fieldId:a.id}),s.push({y:l.y-F/2,type:"field-edge",fieldId:a.id}),s.push({y:l.y+F/2,type:"field-edge",fieldId:a.id})}}),s},M=(t,s,a)=>{if(!A)return{x:t,y:s};const l=E();let d={distance:Q,value:void 0,type:""},h={distance:Q,value:void 0,type:""};const F={center:10,field:8,"field-edge":6,edge:4,grid:2};return l.forEach(S=>{if(S.x!==void 0){const T=Math.abs(t-S.x),N=F[S.type||"grid"]||0;(T<d.distance||T===d.distance&&N>F[d.type||"grid"])&&(d={distance:T,value:S.x,type:S.type||""})}if(S.y!==void 0){const T=Math.abs(s-S.y),N=F[S.type||"grid"]||0;(T<h.distance||T===h.distance&&N>F[h.type||"grid"])&&(h={distance:T,value:S.y,type:S.type||""})}}),K({x:d.value,y:h.value,xType:d.type,yType:h.type}),{x:d.value!==void 0?d.value:t,y:h.value!==void 0?h.value:s}},D=(t,s)=>{if(p.length===0)return;m();const a=g.map(l=>{if(p.includes(l.id)){const d=H(l),h={x:d.x+t,y:d.y+s},F=A?M(h.x,h.y):h;return{...l,position:{x:parseFloat((F.x/o.width*100).toFixed(2)),y:parseFloat((F.y/o.height*100).toFixed(2)),snapToGrid:l.position.snapToGrid}}}return l});r(a)},q=()=>{if(!I.current)return;const t={...f},s=[...p];K({}),x([]),setTimeout(()=>{const a=I.current.toDataURL({pixelRatio:2,mimeType:"image/png"}),l=document.createElement("a");l.download="تصميم-القالب.png",l.href=a,document.body.appendChild(l),l.click(),document.body.removeChild(l),K(t),x(s)},100)},J=t=>{if(t.ctrlKey){t.preventDefault();const a=t.deltaY>0?.9:1.1;z(l=>Math.max(.2,Math.min(4,l*a)))}else t.shiftKey&&(t.preventDefault(),_(s=>({x:s.x-t.deltaY,y:s.y})))},c=(t,s)=>{if(!t||(m(),g.findIndex(N=>N.id===t)===-1))return;const l=[...g].sort((N,P)=>(N.zIndex||0)-(P.zIndex||0)),d=l.findIndex(N=>N.id===t);let h;if(s==="up"){if(h=d+1,h>=l.length)return}else if(h=d-1,h<0)return;const F=l[d].zIndex||0,S=l[h].zIndex||0,T=g.map(N=>N.id===t?{...N,zIndex:S}:N.id===l[h].id?{...N,zIndex:F}:N);r(T)},de=t=>{if(!t)return;m();const s=g.map(a=>a.id===t?{...a,visible:a.visible===!1}:a);r(s)},ie=()=>{if(p.length===0)return;m();const t=g.filter(s=>!p.includes(s.id));x([]),r(t)},we=()=>{if(p.length===0)return;m();const t=g.filter(d=>p.includes(d.id)),s=Math.max(...g.map(d=>d.id),0),a=t.map((d,h)=>({...JSON.parse(JSON.stringify(d)),id:s+h+1,position:{...d.position,x:d.position.x+3,y:d.position.y+3}})),l=[...g,...a];x(a.map(d=>d.id)),r(l)},Pe=(t,s)=>{const a=g.find(P=>P.id===t);if(!a)return;m();const{x:l,y:d,width:h,height:F,rotation:S}=s,T={...a,position:{x:parseFloat((l/o.width*100).toFixed(2)),y:parseFloat((d/o.height*100).toFixed(2)),snapToGrid:a.position.snapToGrid},size:{width:h,height:F},rotation:S},N=g.map(P=>P.id===t?T:P);r(N)},Oe=t=>{var S,T,N,P,Fe,Se;if(t.visible===!1)return null;const s=H(t),a=t.style||{},l=(a.fontSize||24)*(o.width/le),d=((S=t.size)==null?void 0:S.width)||(a.width||200)*(o.width/le),h=((T=t.size)==null?void 0:T.height)||(a.height||100)*(o.width/le);p.includes(t.id);const F=t.rotation||0;return t.type==="text"?e.jsx(Le,{id:`field-${t.id}`,text:t.label||t.name,fontSize:l,fontFamily:a.fontFamily||"Cairo",fontStyle:a.fontWeight==="bold"?"bold":"normal",fill:a.color||"#000000",align:a.align||"center",width:d,height:h,wrap:"word",x:s.x,y:s.y,rotation:F,shadowColor:(N=a.textShadow)!=null&&N.enabled?((P=a.textShadow)==null?void 0:P.color)||"#000000":"transparent",shadowBlur:(Fe=a.textShadow)!=null&&Fe.enabled?((Se=a.textShadow)==null?void 0:Se.blur)||3:0,perfectDrawEnabled:!0,draggable:!0,onClick:()=>{x([t.id])},onDragStart:()=>{p.includes(t.id)||x([t.id])},onDragEnd:ae=>{const he=parseFloat((ae.target.x()/o.width*100).toFixed(2)),xe=parseFloat((ae.target.y()/o.height*100).toFixed(2)),me={...t,position:{x:he,y:xe,snapToGrid:t.position.snapToGrid}};m();const pe=g.map(ne=>ne.id===t.id?me:ne);r(pe)}},t.id):t.type==="image"?e.jsx(_e,{id:`field-${t.id}`,x:s.x,y:s.y,width:d,height:h,fill:"rgba(200, 200, 255, 0.3)",stroke:"#aaa",strokeWidth:1,cornerRadius:a.imageRounded?Math.min(d,h)/10:0,perfectDrawEnabled:!0,draggable:!0,rotation:F,onClick:()=>{x([t.id])},onDragStart:()=>{p.includes(t.id)||x([t.id])},onDragEnd:ae=>{const he=parseFloat((ae.target.x()/o.width*100).toFixed(2)),xe=parseFloat((ae.target.y()/o.height*100).toFixed(2)),me={...t,position:{x:he,y:xe,snapToGrid:t.position.snapToGrid}};m();const pe=g.map(ne=>ne.id===t.id?me:ne);r(pe)}},t.id):null},Ae=[...g].sort((t,s)=>(t.zIndex||0)-(s.zIndex||0));return e.jsxs("div",{className:`relative ${X}`,ref:O,children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:()=>z(t=>Math.min(t+.1,4)),className:"p-2 bg-blue-100 hover:bg-blue-200 rounded",title:"تكبير",children:e.jsx(Qe,{size:18})}),e.jsx("button",{onClick:()=>z(t=>Math.max(t-.1,.2)),className:"p-2 bg-blue-100 hover:bg-blue-200 rounded",title:"تصغير",children:e.jsx(et,{size:18})}),e.jsx("button",{onClick:()=>oe(!Y),className:`p-2 ${Y?"bg-green-100 hover:bg-green-200":"bg-gray-100 hover:bg-gray-200"} rounded`,title:"إظهار/إخفاء الشبكة",children:e.jsx(Be,{size:18})}),e.jsx("button",{onClick:q,className:"p-2 bg-blue-100 hover:bg-blue-200 rounded",title:"تصدير كصورة",children:e.jsx(Ge,{size:18})})]}),p.length>0&&e.jsxs("div",{className:"flex gap-2 mb-3",children:[e.jsx("button",{onClick:we,className:"p-2 bg-indigo-100 hover:bg-indigo-200 rounded",title:"نسخ",children:e.jsx(Ve,{size:18})}),e.jsx("button",{onClick:ie,className:"p-2 bg-red-100 hover:bg-red-200 rounded",title:"حذف",children:e.jsx(tt,{size:18})}),e.jsx("button",{onClick:()=>p.length===1&&c(p[0],"up"),className:"p-2 bg-yellow-100 hover:bg-yellow-200 rounded",title:"طبقة للأمام",children:e.jsx(st,{size:18})}),e.jsx("button",{onClick:()=>p.length===1&&c(p[0],"down"),className:"p-2 bg-yellow-100 hover:bg-yellow-200 rounded",title:"طبقة للخلف",children:e.jsx(it,{size:18})}),e.jsx("button",{onClick:()=>p.length===1&&de(p[0]),className:"p-2 bg-purple-100 hover:bg-purple-200 rounded",title:"إظهار/إخفاء",children:p.length===1&&((be=g.find(t=>t.id===p[0]))==null?void 0:be.visible)===!1?e.jsx(He,{size:18}):e.jsx(Re,{size:18})})]})]}),e.jsx("div",{className:"relative border rounded-lg overflow-hidden",onWheel:J,children:e.jsx(We,{ref:I,width:o.width,height:o.height,scaleX:v,scaleY:v,x:w.x,y:w.y,onClick:t=>{t.target===t.currentTarget&&x([])},children:e.jsxs(De,{children:[G&&e.jsx($e,{image:G,width:o.width,height:o.height,x:0,y:0,listening:!1}),Y&&se&&e.jsxs(e.Fragment,{children:[Array.from({length:Math.ceil(o.height/W)+1}).map((t,s)=>e.jsx(ee,{points:[0,s*W,o.width,s*W],stroke:"rgba(200, 200, 200, 0.3)",strokeWidth:1,perfectDrawEnabled:!0,listening:!1},`grid-h-${s}`)),Array.from({length:Math.ceil(o.width/W)+1}).map((t,s)=>e.jsx(ee,{points:[s*W,0,s*W,o.height],stroke:"rgba(200, 200, 200, 0.3)",strokeWidth:1,perfectDrawEnabled:!0,listening:!1},`grid-v-${s}`)),e.jsx(ee,{points:[o.width/2,0,o.width/2,o.height],stroke:"rgba(100, 100, 255, 0.5)",strokeWidth:1,dash:[5,5],perfectDrawEnabled:!0,listening:!1}),e.jsx(ee,{points:[0,o.height/2,o.width,o.height/2],stroke:"rgba(100, 100, 255, 0.5)",strokeWidth:1,dash:[5,5],perfectDrawEnabled:!0,listening:!1})]}),Ae.map(t=>Oe(t)),A&&e.jsxs(e.Fragment,{children:[f.x!==void 0&&e.jsx(ee,{points:[f.x,0,f.x,o.height],stroke:f.xType==="center"?"rgba(255, 0, 0, 0.7)":f.xType==="field"?"rgba(0, 100, 255, 0.7)":"rgba(0, 255, 0, 0.7)",strokeWidth:1,dash:[4,4],perfectDrawEnabled:!0,listening:!1}),f.y!==void 0&&e.jsx(ee,{points:[0,f.y,o.width,f.y],stroke:f.yType==="center"?"rgba(255, 0, 0, 0.7)":f.yType==="field"?"rgba(0, 100, 255, 0.7)":"rgba(0, 255, 0, 0.7)",strokeWidth:1,dash:[4,4],perfectDrawEnabled:!0,listening:!1})]}),p.length===1&&e.jsx(Xe,{ref:$,boundBoxFunc:(t,s)=>s.width<10||s.height<10?t:s,rotateEnabled:!0,rotationSnaps:[0,45,90,135,180,225,270,315],node:(Ne=I.current)==null?void 0:Ne.findOne(`#field-${p[0]}`),onTransformEnd:()=>{var a;const t=(a=I.current)==null?void 0:a.findOne(`#field-${p[0]}`);if(!t)return;const s={x:t.x(),y:t.y(),width:t.width()*t.scaleX(),height:t.height()*t.scaleY(),rotation:t.rotation()};t.scaleX(1),t.scaleY(1),Pe(p[0],s)}})]})})}),p.length===1&&e.jsxs("div",{className:"mt-4 p-3 bg-gray-50 rounded border",children:[e.jsx("h3",{className:"text-sm font-bold mb-2",children:"معلومات الحقل"}),e.jsx("div",{className:"text-xs",children:(()=>{var s,a;const t=g.find(l=>l.id===p[0]);return t?e.jsxs(e.Fragment,{children:[e.jsxs("div",{children:["الاسم: ",t.name]}),e.jsxs("div",{children:["النوع: ",t.type==="text"?"نص":"صورة"]}),e.jsxs("div",{children:["الموضع: ",t.position.x.toFixed(1),"%, ",t.position.y.toFixed(1),"%"]}),t.rotation&&e.jsxs("div",{children:["الدوران: ",t.rotation.toFixed(1),"°"]}),t.type==="text"&&((s=t.style)==null?void 0:s.fontSize)&&e.jsxs("div",{children:["حجم الخط: ",t.style.fontSize,"px"]}),t.type==="text"&&((a=t.style)==null?void 0:a.fontFamily)&&e.jsxs("div",{children:["الخط: ",t.style.fontFamily]}),t.visible===!1&&e.jsx("div",{className:"text-red-500",children:"مخفي"})]}):null})()})]})]})},mt=({templateImage:V,fields:g=[],formData:r={},format:y="instagram",onImageGenerated:X,className:O="",quality:I="preview"})=>{const $=j.useRef(null),[G,Z]=j.useState(null),[o,te]=j.useState({width:800,height:800}),{data:v}=ve({queryKey:["/api/social-formats"],queryFn:()=>ce("GET","/api/social-formats")}),w=((v==null?void 0:v.formats)||{instagram:{width:1080,height:1080,ratio:"1:1",description:"Instagram (Square)"},facebook:{width:1200,height:630,ratio:"1.91:1",description:"Facebook"},twitter:{width:1200,height:675,ratio:"16:9",description:"Twitter"},linkedin:{width:1200,height:627,ratio:"1.91:1",description:"LinkedIn"},whatsapp:{width:800,height:800,ratio:"1:1",description:"WhatsApp"}})[y];j.useEffect(()=>{if(!V||!w)return;const x=new window.Image;x.crossOrigin="anonymous",x.src=V,x.onload=()=>{Z(x);const n=w.width/w.height;let u=Math.min(800,window.innerWidth-40),C=u/n;console.log(`Format: ${y}, Ratio: ${n}`),console.log(`Display size: ${u}x${C}`),te({width:u,height:C})},x.onerror=n=>{console.error("Failed to load template image:",n)}},[V,y,w]);const _=x=>(r[x.name]??x.defaultValue??x.label??"").toString(),f=x=>{var q,J,c;if(x.visible===!1)return null;const n=x.style||{},u=n.fontFamily||"Cairo",C=o.width/w.width;let L=n.fontSize||24;L<14&&(L=14),L>60&&(L=60);const Y=Math.round(L*C),W=(n.fontWeight||"normal")==="bold"?"bold":"normal",Q=x.position.x/100*o.width,se=x.position.y/100*o.height,A=n.align||"center";let H=0;A==="center"&&(H=0);const m=n.maxWidth?Math.round((n.maxWidth||200)*C):Math.round(o.width-50*C),i=((q=n.textShadow)==null?void 0:q.enabled)||!1,b=i?((J=n.textShadow)==null?void 0:J.color)||"black":"transparent",E=i?(((c=n.textShadow)==null?void 0:c.blur)||3)*C:0,M=n.color||"#000000",D=x.rotation||0;return{text:_(x),x:Q,y:se,fontSize:Y,fontFamily:u,fontStyle:W,fill:M,align:A,width:m,offsetX:H,shadowColor:b,shadowBlur:E,shadowOffset:{x:0,y:0},perfectDrawEnabled:!0,rotation:D}},K=()=>{if(!$.current)return;let x;I==="high"?x=2:I==="medium"?x=1.5:x=1,console.log(`Generating social preview image for ${y} with pixelRatio: ${x}`);const n=$.current.toDataURL({pixelRatio:x,mimeType:"image/png",quality:1});console.log(`Generated image data URL length: ${n.length}`),X&&X(n)};j.useEffect(()=>{if(G&&$.current&&w){const x=setTimeout(()=>{console.log("Generating social image after elements loaded"),K()},200);return()=>clearTimeout(x)}},[G,g,r,o,I,y,w]);const p=[...g].sort((x,n)=>(x.zIndex||0)-(n.zIndex||0)).filter(x=>x.visible!==!1);return e.jsxs("div",{className:`relative ${O}`,children:[e.jsxs("h2",{className:"text-center text-sm font-medium mb-2",children:[(w==null?void 0:w.description)||y," (",(w==null?void 0:w.width)||0,"×",(w==null?void 0:w.height)||0,")"]}),e.jsx(We,{ref:$,width:o.width,height:o.height,style:{margin:"0 auto",border:"1px solid #eee",borderRadius:"4px",overflow:"hidden"},children:e.jsxs(De,{children:[G&&e.jsx($e,{image:G,width:o.width,height:o.height,perfectDrawEnabled:!0}),p.map((x,n)=>e.jsx(Le,{...f(x)},`${x.name}-${n}`))]})})]})},Rt=V=>{var H;const g=V.templateId||((H=V.params)==null?void 0:H.templateId),{t:r}=Ue(),{toast:y}=Ze(),[X,O]=j.useState("editor"),[I,$]=j.useState("instagram"),[G,Z]=j.useState(null),[o,te]=j.useState({}),[v,z]=j.useState([]),[w,_]=j.useState(null),{data:f,isLoading:K}=ve({queryKey:["/api/templates",g],queryFn:()=>ce("GET",`/api/templates/${g}`),enabled:!!g});ve({queryKey:["/api/social-formats"],queryFn:()=>ce("GET","/api/social-formats")});const{mutate:p,isPending:x}=Ke({mutationFn:async m=>ce("PUT",`/api/templates/${g}`,m),onSuccess:()=>{y({title:r("success"),description:r("templateSaved")})},onError:m=>{y({title:r("error"),description:r("errorSavingTemplate"),variant:"destructive"})}});j.useEffect(()=>{if(f){const i=f.fields.map((b,E)=>({...b,zIndex:b.zIndex!==void 0?b.zIndex:E}));z(i)}},[f]);const n=G!==null?v.find(m=>m.id===G):null,u=m=>{const i=v.map(b=>b.id===m.id?m:b);z(i)},C=m=>{const i=Math.max(0,...v.map(M=>M.id)),b=Math.max(0,...v.map(M=>M.zIndex||0)),E={id:i+1,name:m==="text"?`text_${i+1}`:`image_${i+1}`,label:r(m==="text"?"newTextField":"newImageField"),type:m,position:{x:50,y:50},zIndex:b+1,style:m==="text"?{fontFamily:"Cairo",fontSize:24,color:"#000000",align:"center"}:{imageMaxWidth:200,imageMaxHeight:200}};z([...v,E]),Z(E.id)},L=m=>{const i=v.filter(b=>b.id!==m);z(i),Z(null)},Y=m=>{const i=v.find(D=>D.id===m);if(!i)return;const b=Math.max(0,...v.map(D=>D.id)),E=Math.max(0,...v.map(D=>D.zIndex||0)),M={...JSON.parse(JSON.stringify(i)),id:b+1,name:`${i.name}_copy`,zIndex:E+1,position:{...i.position,x:i.position.x+5,y:i.position.y+5}};z([...v,M]),Z(M.id)},oe=m=>{const i=v.find(b=>b.id===m);i&&u({...i,visible:i.visible===!1})},W=()=>{const m={fields:v.map(i=>({...i,position:{x:i.position.x,y:i.position.y}}))};p(m)},Q=()=>{if(w){const m=`${(f==null?void 0:f.title)||"template"}_${I}.png`;Ye(w,m)}},se=()=>{const m={};v.forEach(i=>{i.type==="text"?m[i.name]=i.label||i.name:i.type==="image"&&(m[i.name]="/uploads/placeholder.jpg")}),te(m)};j.useEffect(()=>{se()},[v]);const A=()=>{var b,E,M,D,q,J;if(!n)return e.jsx("div",{className:"p-4 text-center text-gray-500",children:r("selectFieldToEdit")});const{type:m,style:i={}}=n;return e.jsxs("div",{className:"space-y-4 p-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("h3",{className:"text-sm font-medium",children:n.name}),e.jsxs("div",{className:"space-x-2 rtl:space-x-reverse",children:[e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>oe(n.id),title:n.visible===!1?r("show"):r("hide"),children:n.visible===!1?e.jsx(He,{size:18}):e.jsx(Re,{size:18})}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>Y(n.id),title:r("duplicate"),children:e.jsx(Ve,{size:18})}),e.jsx(R,{variant:"ghost",size:"icon",onClick:()=>L(n.id),title:r("delete"),className:"text-red-500 hover:text-red-700 hover:bg-red-50",children:e.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[e.jsx("path",{d:"M3 6h18"}),e.jsx("path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6"}),e.jsx("path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2"})]})})]})]}),e.jsx(Ce,{}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-label",children:r("label")}),e.jsx(re,{id:"field-label",value:n.label||"",onChange:c=>u({...n,label:c.target.value})})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"field-position-x",children:[r("positionX")," (%)"]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-position-x",min:0,max:100,step:.1,value:[n.position.x],onValueChange:c=>u({...n,position:{...n.position,x:c[0]}})}),e.jsx("span",{className:"w-10 text-center",children:n.position.x.toFixed(1)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"field-position-y",children:[r("positionY")," (%)"]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-position-y",min:0,max:100,step:.1,value:[n.position.y],onValueChange:c=>u({...n,position:{...n.position,y:c[0]}})}),e.jsx("span",{className:"w-10 text-center",children:n.position.y.toFixed(1)})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"field-rotation",children:[r("rotation")," (°)"]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-rotation",min:0,max:360,step:1,value:[n.rotation||0],onValueChange:c=>u({...n,rotation:c[0]})}),e.jsxs("span",{className:"w-10 text-center",children:[(n.rotation||0).toFixed(0),"°"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-z-index",children:r("layer")}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-z-index",min:0,max:Math.max(10,...v.map(c=>c.zIndex||0)+1),step:1,value:[n.zIndex||0],onValueChange:c=>u({...n,zIndex:c[0]})}),e.jsx("span",{className:"w-10 text-center",children:n.zIndex||0})]})]}),e.jsx(Ce,{}),m==="text"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-font-family",children:r("fontFamily")}),e.jsxs(ue,{value:i.fontFamily||"Cairo",onValueChange:c=>u({...n,style:{...i,fontFamily:c}}),children:[e.jsx(ge,{id:"field-font-family",children:e.jsx(fe,{placeholder:r("selectFont")})}),e.jsxs(ye,{children:[e.jsx(B,{value:"Cairo",children:"Cairo"}),e.jsx(B,{value:"Tajawal",children:"Tajawal"}),e.jsx(B,{value:"Amiri",children:"Amiri"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs(k,{htmlFor:"field-font-size",children:[r("fontSize")," (px)"]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-font-size",min:14,max:60,step:1,value:[i.fontSize||24],onValueChange:c=>u({...n,style:{...i,fontSize:c[0]}})}),e.jsx("span",{className:"w-10 text-center",children:i.fontSize||24})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-font-weight",children:r("fontWeight")}),e.jsxs(ue,{value:i.fontWeight||"normal",onValueChange:c=>u({...n,style:{...i,fontWeight:c}}),children:[e.jsx(ge,{id:"field-font-weight",children:e.jsx(fe,{placeholder:r("selectFontWeight")})}),e.jsxs(ye,{children:[e.jsx(B,{value:"normal",children:r("normal")}),e.jsx(B,{value:"bold",children:r("bold")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-text-align",children:r("textAlign")}),e.jsxs(ue,{value:i.align||"center",onValueChange:c=>u({...n,style:{...i,align:c}}),children:[e.jsx(ge,{id:"field-text-align",children:e.jsx(fe,{placeholder:r("selectAlignment")})}),e.jsxs(ye,{children:[e.jsx(B,{value:"left",children:r("left")}),e.jsx(B,{value:"center",children:r("center")}),e.jsx(B,{value:"right",children:r("right")})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-color",children:r("color")}),e.jsxs("div",{className:"flex",children:[e.jsx(re,{id:"field-color",type:"color",value:i.color||"#000000",onChange:c=>u({...n,style:{...i,color:c.target.value}}),className:"w-12 h-10 p-1 ml-2"}),e.jsx(re,{type:"text",value:i.color||"#000000",onChange:c=>u({...n,style:{...i,color:c.target.value}}),className:"flex-1 ml-2"})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(k,{htmlFor:"field-text-shadow",children:r("textShadow")}),e.jsx(je,{id:"field-text-shadow",checked:((b=i.textShadow)==null?void 0:b.enabled)||!1,onCheckedChange:c=>{var de,ie;return u({...n,style:{...i,textShadow:{...i.textShadow||{},enabled:c,color:((de=i.textShadow)==null?void 0:de.color)||"#000000",blur:((ie=i.textShadow)==null?void 0:ie.blur)||3}}})}})]}),((E=i.textShadow)==null?void 0:E.enabled)&&e.jsxs("div",{className:"space-y-2 mt-2",children:[e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(k,{className:"w-20",children:r("shadowColor")}),e.jsx(re,{type:"color",value:((M=i.textShadow)==null?void 0:M.color)||"#000000",onChange:c=>u({...n,style:{...i,textShadow:{...i.textShadow,color:c.target.value}}}),className:"w-12 h-10 p-1"}),e.jsx(re,{type:"text",value:((D=i.textShadow)==null?void 0:D.color)||"#000000",onChange:c=>u({...n,style:{...i,textShadow:{...i.textShadow,color:c.target.value}}}),className:"flex-1"})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(k,{className:"w-20",children:r("shadowBlur")}),e.jsx(U,{min:0,max:20,step:1,value:[((q=i.textShadow)==null?void 0:q.blur)||3],onValueChange:c=>u({...n,style:{...i,textShadow:{...i.textShadow,blur:c[0]}}}),className:"flex-1"}),e.jsxs("span",{className:"w-10 text-center",children:[((J=i.textShadow)==null?void 0:J.blur)||3,"px"]})]})]})]})]}),m==="image"&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-max-width",children:r("maxWidth")}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-max-width",min:50,max:500,step:10,value:[i.imageMaxWidth||200],onValueChange:c=>u({...n,style:{...i,imageMaxWidth:c[0]}})}),e.jsxs("span",{className:"w-12 text-center",children:[i.imageMaxWidth||200,"px"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(k,{htmlFor:"field-max-height",children:r("maxHeight")}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(U,{id:"field-max-height",min:50,max:500,step:10,value:[i.imageMaxHeight||200],onValueChange:c=>u({...n,style:{...i,imageMaxHeight:c[0]}})}),e.jsxs("span",{className:"w-12 text-center",children:[i.imageMaxHeight||200,"px"]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(k,{htmlFor:"field-image-rounded",className:"flex-1",children:r("roundedCorners")}),e.jsx(je,{id:"field-image-rounded",checked:i.imageRounded||!1,onCheckedChange:c=>u({...n,style:{...i,imageRounded:c}})})]}),e.jsxs("div",{className:"flex items-center space-x-2 rtl:space-x-reverse",children:[e.jsx(k,{htmlFor:"field-image-border",className:"flex-1",children:r("border")}),e.jsx(je,{id:"field-image-border",checked:i.imageBorder||!1,onCheckedChange:c=>u({...n,style:{...i,imageBorder:c}})})]})]})]})};return K?e.jsx("div",{className:"flex items-center justify-center min-h-[400px]",children:e.jsx("div",{className:"w-10 h-10 border-4 border-primary border-t-transparent rounded-full animate-spin"})}):e.jsx("div",{className:"container mx-auto py-6",children:e.jsxs("div",{className:"flex flex-col space-y-4 lg:flex-row lg:space-y-0 lg:space-x-6 rtl:space-x-reverse",children:[e.jsx("div",{className:"lg:w-3/4",children:e.jsxs(ke,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx(ze,{children:(f==null?void 0:f.title)||r("templateEditor")}),e.jsx("div",{className:"space-x-2 rtl:space-x-reverse",children:e.jsxs(R,{variant:"outline",onClick:W,disabled:x,children:[r(x?"saving":"save"),e.jsx(at,{className:"ml-2 h-4 w-4"})]})})]})}),e.jsx(Te,{children:e.jsxs(qe,{value:X,onValueChange:O,children:[e.jsxs(Je,{className:"mb-4",children:[e.jsxs(Ee,{value:"editor",children:[e.jsx(nt,{className:"h-4 w-4 mr-2"}),r("editor")]}),e.jsxs(Ee,{value:"social",children:[e.jsxs("svg",{width:"16",height:"16",className:"mr-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M18 2H6a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h12a4 4 0 0 0 4-4V6a4 4 0 0 0-4-4Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM16 9a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM17 15a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"m8.5 13.5 5-3M12.5 11.5l2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),r("socialPreviews")]})]}),e.jsx(Me,{value:"editor",className:"mt-0",children:e.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mb-4",children:[e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>C("text"),children:[e.jsx(rt,{className:"h-4 w-4 mr-2"}),r("addTextField")]}),e.jsxs(R,{variant:"outline",size:"sm",onClick:()=>C("image"),children:[e.jsx(lt,{className:"h-4 w-4 mr-2"}),r("addImageField")]})]}),e.jsx(xt,{templateImage:(f==null?void 0:f.imageUrl)||"",fields:v,onFieldsChange:z,className:"mb-4"})]})}),e.jsx(Me,{value:"social",className:"mt-0",children:e.jsxs("div",{className:"flex flex-col space-y-4",children:[e.jsxs("div",{className:"flex flex-wrap gap-2 mt-2 mb-4",children:[e.jsxs(R,{variant:I==="instagram"?"default":"outline",size:"sm",onClick:()=>$("instagram"),children:[e.jsx(ot,{className:"h-4 w-4 mr-2"}),"Instagram"]}),e.jsxs(R,{variant:I==="facebook"?"default":"outline",size:"sm",onClick:()=>$("facebook"),children:[e.jsx(dt,{className:"h-4 w-4 mr-2"}),"Facebook"]}),e.jsxs(R,{variant:I==="twitter"?"default":"outline",size:"sm",onClick:()=>$("twitter"),children:[e.jsx(ct,{className:"h-4 w-4 mr-2"}),"Twitter"]}),e.jsxs(R,{variant:I==="linkedin"?"default":"outline",size:"sm",onClick:()=>$("linkedin"),children:[e.jsx(ht,{className:"h-4 w-4 mr-2"}),"LinkedIn"]})]}),e.jsx(mt,{templateImage:(f==null?void 0:f.imageUrl)||"",fields:v,formData:o,format:I,quality:"medium",onImageGenerated:_,className:"mb-4"}),e.jsx("div",{className:"flex justify-center",children:e.jsxs(R,{onClick:Q,disabled:!w,children:[e.jsx(Ge,{className:"h-4 w-4 mr-2"}),r("downloadImage")]})})]})})]})})]})}),e.jsx("div",{className:"lg:w-1/4",children:e.jsxs(ke,{children:[e.jsx(Ie,{className:"pb-3",children:e.jsx(ze,{children:r("properties")})}),e.jsx(Te,{className:"p-0",children:A()})]})})]})})};export{Rt as default};
