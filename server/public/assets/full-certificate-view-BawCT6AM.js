import{o as O,a as A,u as L,h as U,r as t,b as q,j as e,c as g,A as N,B as a,k as c,C as o,d as m,m as B,g as E}from"./index-DoMHCGG2.js";import{D as w,b as v,c as C,d as b,e as z}from"./dialog-fsPDLJiu.js";import{S as P}from"./share-options-Dq3pJXip.js";import{C as y}from"./chevron-left-2QWjGYBN.js";import{D as H}from"./download-CkzZtpS5.js";import{S as D}from"./share-2-C3FB-j83.js";import{C as d}from"./copy-DCUs-YoJ.js";import{Q as K}from"./qr-code-BYf2XRjA.js";import"./scroll-area-BaWF6YIt.js";import"./index-BdQq_4o_.js";import"./tabs-CKJmMpcu.js";import"./image-CRCqvbIG.js";import"./twitter-BkFCnlyo.js";import"./instagram-BWPAtAad.js";function le(){const{certificateId:S}=O(),[V,x]=A();L();const{toast:k}=U(),[Q,r]=t.useState(!1),[I,h]=t.useState(!1),[u,j]=t.useState(!1),[l,f]=t.useState(!1);t.useState(!1),t.useState("");const{data:s,isLoading:R,error:T}=q({queryKey:[`/api/certificates/public/${S}`],queryFn:E({})});t.useEffect(()=>{s!=null&&s.id&&fetch(`/api/certificates/${s.id}/view`,{method:"POST"}).catch(i=>console.error("Error registering view:",i))},[s]);const $=()=>{s&&(j(!0),B(s.imageUrl,`شهادة_${s.issuedTo||s.id}.png`).finally(()=>{j(!1)}))},n=()=>{if(s!=null&&s.verificationCode){const i=`${window.location.origin}/certificates/verify/${s.verificationCode}`;navigator.clipboard.writeText(i),f(!0),k({title:"تم نسخ الرابط",description:"تم نسخ رابط التحقق إلى الحافظة"}),setTimeout(()=>f(!1),2e3)}};if(R)return e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(g,{className:"h-8 w-8 animate-spin text-primary"})});if(T||!s)return e.jsx("div",{className:"container mx-auto py-10 text-center",children:e.jsxs("div",{className:"max-w-md mx-auto",children:[e.jsx(N,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"الشهادة غير موجودة"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"لم نتمكن من العثور على الشهادة المطلوبة. قد تكون الشهادة غير صالحة أو تم حذفها."}),e.jsxs(a,{onClick:()=>x("/"),children:[e.jsx(y,{className:"ml-2 h-4 w-4"}),"العودة للرئيسية"]})]})});const F=i=>{switch(i){case"appreciation":return"شهادة تقدير";case"training":return"شهادة تدريب";case"education":return"شهادة تعليم";case"teacher":return"شهادة للمعلمين";default:return"شهادة"}},p=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`${window.location.origin}/certificates/verify/${s.verificationCode}`)}`;return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"mb-6 flex flex-wrap gap-4 justify-between items-center",children:[e.jsxs(a,{variant:"outline",onClick:()=>x("/"),children:[e.jsx(y,{className:"ml-2 h-4 w-4"}),"العودة للرئيسية"]}),e.jsxs("div",{className:"flex flex-wrap gap-2",children:[e.jsx(a,{variant:"outline",onClick:$,disabled:u,className:"min-w-[100px]",children:u?e.jsxs(e.Fragment,{children:[e.jsx(g,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحميل..."]}):e.jsxs(e.Fragment,{children:[e.jsx(H,{className:"ml-2 h-4 w-4"}),"تحميل"]})}),e.jsxs(a,{variant:"outline",onClick:()=>r(!0),children:[e.jsx(D,{className:"ml-2 h-4 w-4"}),"مشاركة الشهادة"]}),e.jsx(a,{variant:"outline",onClick:n,children:l?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"ml-2 h-4 w-4 text-green-500"}),"تم النسخ!"]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"ml-2 h-4 w-4"}),"نسخ رابط التحقق"]})}),e.jsxs(a,{variant:"outline",onClick:()=>h(!0),children:[e.jsx(K,{className:"ml-2 h-4 w-4"}),"عرض رمز QR"]})]})]}),e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold mb-2",children:s.title}),e.jsxs("div",{className:"flex flex-wrap gap-4 text-muted-foreground",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx(N,{className:"h-4 w-4 ml-1"}),F(s.certificateType)]}),s.createdAt&&e.jsxs("div",{children:["تاريخ الإصدار: ",new Date(s.createdAt).toLocaleDateString("ar-SA")]}),s.expiryDate&&e.jsxs("div",{children:["تاريخ الانتهاء: ",new Date(s.expiryDate).toLocaleDateString("ar-SA")]})]})]}),e.jsxs("div",{className:"grid md:grid-cols-3 gap-6 mb-8",children:[e.jsx("div",{className:"md:col-span-2",children:e.jsx(o,{className:"overflow-hidden",children:e.jsx(m,{className:"p-0",children:e.jsx("div",{className:"aspect-[1.414/1] w-full bg-white",children:e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-contain"})})})})}),e.jsxs("div",{className:"space-y-6",children:[e.jsx(o,{children:e.jsxs(m,{className:"p-6",children:[e.jsx("h2",{className:"text-lg font-medium mb-4",children:"معلومات الشهادة"}),s.issuedTo&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"الممنوحة إلى"}),e.jsx("p",{className:"font-medium",children:s.issuedTo})]}),s.issuedBy&&e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"الجهة المانحة"}),e.jsx("p",{children:s.issuedBy})]}),e.jsxs("div",{className:"mb-4",children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"رمز التحقق"}),e.jsxs("div",{className:"flex items-center mt-1",children:[e.jsx("code",{className:"bg-muted px-2 py-1 rounded text-sm font-mono",children:s.verificationCode}),e.jsx(a,{variant:"ghost",size:"sm",className:"h-8 px-2 ml-2",onClick:n,children:l?e.jsx(c,{className:"h-4 w-4 text-green-500"}):e.jsx(d,{className:"h-4 w-4"})})]})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium text-muted-foreground",children:"رابط التحقق"}),e.jsx("p",{className:"text-sm break-all mt-1 text-muted-foreground",children:`${window.location.origin}/certificates/verify/${s.verificationCode}`})]})]})}),e.jsxs("div",{className:"text-center",children:[e.jsx("img",{src:p,alt:"QR Code",className:"mx-auto mb-2 max-w-[150px]"}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"امسح رمز QR للتحقق من صحة الشهادة"})]}),e.jsx(o,{children:e.jsx(m,{className:"p-4",children:e.jsxs(a,{variant:"outline",className:"w-full",onClick:()=>r(!0),children:[e.jsx(D,{className:"ml-2 h-4 w-4"}),"مشاركة الشهادة"]})})})]})]}),e.jsx(w,{open:Q,onOpenChange:r,children:e.jsxs(v,{className:"max-w-md",children:[e.jsxs(C,{children:[e.jsx(b,{children:"مشاركة الشهادة"}),e.jsx(z,{children:"شارك هذه الشهادة مع العائلة والأصدقاء"})]}),e.jsx(P,{cardId:s.publicId,imageUrl:s.imageUrl,templateId:s.templateId})]})}),e.jsx(w,{open:I,onOpenChange:h,children:e.jsxs(v,{className:"text-center",children:[e.jsx(C,{children:e.jsx(b,{children:"رمز QR للتحقق"})}),e.jsx("div",{className:"py-6 flex justify-center",children:e.jsx("img",{src:p,alt:"QR Code",className:"max-w-full"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"يمكن استخدام رمز QR للتحقق من صحة الشهادة"}),e.jsx(a,{variant:"outline",onClick:n,children:l?e.jsxs(e.Fragment,{children:[e.jsx(c,{className:"ml-2 h-4 w-4 text-green-500"}),"تم النسخ!"]}):e.jsxs(e.Fragment,{children:[e.jsx(d,{className:"ml-2 h-4 w-4"}),"نسخ رابط التحقق"]})})]})})]})}export{le as default};
