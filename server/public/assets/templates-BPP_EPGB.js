import{h as I,r as y,b as P,i as L,j as e,c as V,B as Q,L as o,C as B,s as Z,t as A,v as H,d as W,K as R,N as O,O as z,P as Y,Q as _,V as n,Y as S,Z as k,_ as q}from"./index-DoMHCGG2.js";import{I as G}from"./input-COMsjQRu.js";import{S as J,a as X,b as ee,c as se,d as $}from"./select-CRu623qS.js";import{T as ae,a as te,b as C,c as b}from"./tabs-CKJmMpcu.js";import{T as re,a as ie,b as F,c,d as le,e as d}from"./table-I-YXpiuN.js";import{S as ne}from"./switch-DKvoDZdm.js";import{P as ce}from"./plus-B2are30l.js";import{S as de}from"./search-CdLD-xpV.js";import{F as oe}from"./filter-7iR-QHWX.js";import{I as xe}from"./image-CRCqvbIG.js";import{E as me}from"./ellipsis-vertical-CjI7CaMN.js";import{P as he}from"./pencil-w_OmdVc4.js";import{E as ue}from"./eye-Co1cENxs.js";import{P as je}from"./panels-top-left-Bk9o9okL.js";import{P as pe}from"./panel-left-CzVvhOjt.js";import{T as ge}from"./trash-2-Dn6YYs7e.js";import"./index-BdQq_4o_.js";import"./chevron-up-DgjV3eGa.js";function Qe(){const{toast:i}=I(),[l,g]=y.useState(""),[m,h]=y.useState("all"),[x,f]=y.useState("all"),{data:s,isLoading:M}=P({queryKey:["/api/templates"],queryFn:q({})}),{data:t,isLoading:D}=P({queryKey:["/api/categories"],queryFn:q({})}),u=(s==null?void 0:s.templates)||[];s!=null&&s.total;const v=u.filter(a=>{var E;const r=l?a.title.toLowerCase().includes(l.toLowerCase())||a.titleAr&&a.titleAr.toLowerCase().includes(l.toLowerCase())||a.slug.toLowerCase().includes(l.toLowerCase()):!0,p=m==="all"||((E=t==null?void 0:t.find(U=>U.id===a.categoryId))==null?void 0:E.slug)===m,K=x==="all"||x==="active"&&a.active||x==="inactive"&&!a.active;return r&&p&&K}),j=L({mutationFn:async({id:a,active:r})=>(await S("PUT",`/api/admin/templates/${a}`,{active:r})).json(),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/templates"]}),i({title:"تم تحديث حالة القالب بنجاح"})},onError:a=>{i({title:"فشل تحديث القالب",description:a.message,variant:"destructive"})}});L({mutationFn:async a=>(await S("DELETE",`/api/admin/templates/${a}`)).json(),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/templates"]}),i({title:"تم حذف القالب بنجاح"})},onError:a=>{i({title:"فشل حذف القالب",description:a.message,variant:"destructive"})}});const N=(a,r)=>{j.mutate({id:a,active:!r})},w=a=>{const r=t==null?void 0:t.find(p=>p.id===a);return r?r.name:"غير معروف"};return M||D?e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(V,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"القوالب"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة قوالب البطاقات والشهادات"})]}),e.jsx(Q,{asChild:!0,children:e.jsxs(o,{href:"/admin/templates/new",children:[e.jsx(ce,{className:"h-4 w-4 ml-2"}),"إضافة قالب"]})})]}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center md:justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(de,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(G,{placeholder:"البحث في القوالب...",className:"pr-9",value:l,onChange:a=>g(a.target.value)})]}),e.jsx("div",{className:"flex flex-wrap gap-4",children:e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(oe,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(J,{value:m,onValueChange:h,children:[e.jsx(X,{className:"w-[160px]",children:e.jsx(ee,{placeholder:"جميع التصنيفات"})}),e.jsxs(se,{children:[e.jsx($,{value:"all",children:"جميع التصنيفات"}),t==null?void 0:t.map(a=>e.jsx($,{value:a.slug,children:a.name},a.id))]})]})]})})]}),e.jsxs(ae,{value:x,onValueChange:f,children:[e.jsxs(te,{children:[e.jsxs(C,{value:"all",children:["الكل (",u.length,")"]}),e.jsxs(C,{value:"active",children:["نشط (",u.filter(a=>a.active).length,")"]}),e.jsxs(C,{value:"inactive",children:["غير نشط (",u.filter(a=>!a.active).length,")"]})]}),e.jsx(b,{value:"all",className:"mt-4",children:e.jsx(T,{templates:v,getCategoryName:w,toggleStatus:N,isUpdating:j.isPending})}),e.jsx(b,{value:"active",className:"mt-4",children:e.jsx(T,{templates:v,getCategoryName:w,toggleStatus:N,isUpdating:j.isPending})}),e.jsx(b,{value:"inactive",className:"mt-4",children:e.jsx(T,{templates:v,getCategoryName:w,toggleStatus:N,isUpdating:j.isPending})})]})]})}function T({templates:i,getCategoryName:l,toggleStatus:g,isUpdating:m}){const{toast:h}=I(),x=L({mutationFn:async s=>(await S("DELETE",`/api/admin/templates/${s}`)).json(),onSuccess:()=>{k.invalidateQueries({queryKey:["/api/templates"]}),h({title:"تم حذف القالب بنجاح"})},onError:s=>{h({title:"فشل حذف القالب",description:s.message,variant:"destructive"})}}),f=s=>{window.confirm("هل أنت متأكد من حذف هذا القالب؟ لا يمكن التراجع عن هذه العملية.")&&x.mutate(s)};return e.jsxs(B,{children:[e.jsxs(Z,{className:"pb-3",children:[e.jsx(A,{children:"القوالب"}),e.jsxs(H,{children:["عدد القوالب: ",i.length]})]}),e.jsx(W,{children:i.length?e.jsx("div",{className:"border rounded-md",children:e.jsxs(re,{children:[e.jsx(ie,{children:e.jsxs(F,{children:[e.jsx(c,{className:"w-20",children:"الصورة"}),e.jsx(c,{children:"العنوان"}),e.jsx(c,{children:"التصنيف"}),e.jsx(c,{className:"text-center",children:"المعرف"}),e.jsx(c,{className:"text-center",children:"الترتيب"}),e.jsx(c,{className:"text-center",children:"الحالة"}),e.jsx(c,{className:"w-12"})]})}),e.jsx(le,{children:i.map(s=>e.jsxs(F,{children:[e.jsx(d,{children:e.jsx("div",{className:"w-14 h-14 rounded-md overflow-hidden bg-muted",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center w-full h-full text-muted-foreground",children:e.jsx(xe,{className:"h-6 w-6"})})})}),e.jsxs(d,{children:[e.jsx("div",{className:"font-medium",children:s.title}),s.titleAr&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.titleAr})]}),e.jsx(d,{children:l(s.categoryId)}),e.jsx(d,{className:"text-center",children:e.jsx("code",{className:"bg-muted text-sm px-1 py-0.5 rounded",children:s.slug})}),e.jsx(d,{className:"text-center",children:s.displayOrder}),e.jsx(d,{className:"text-center",children:e.jsx(ne,{checked:s.active,onCheckedChange:()=>g(s.id,s.active),disabled:m})}),e.jsx(d,{children:e.jsxs(R,{children:[e.jsx(O,{asChild:!0,children:e.jsx(Q,{variant:"ghost",size:"icon",children:e.jsx(me,{className:"h-4 w-4"})})}),e.jsxs(z,{align:"end",children:[e.jsx(Y,{children:"خيارات"}),e.jsx(_,{}),e.jsx(n,{asChild:!0,children:e.jsxs(o,{href:`/admin/templates/${s.id}`,children:[e.jsx(he,{className:"h-4 w-4 ml-2"}),"تعديل"]})}),e.jsx(n,{asChild:!0,className:"text-primary",children:e.jsxs(o,{href:`/admin/templates/${s.id}/fields`,children:[e.jsx(ue,{className:"h-4 w-4 ml-2"}),e.jsx("span",{className:"flex-1",children:"إدارة الحقول"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-primary/10 text-primary",children:"محسن"})]})}),e.jsx(n,{asChild:!0,className:"text-primary",children:e.jsxs(o,{href:`/admin/template-editor/${s.id}`,children:[e.jsx(je,{className:"h-4 w-4 ml-2"}),e.jsx("span",{className:"flex-1",children:"محرر التخطيط"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-purple-500/10 text-purple-500",children:"جديد"})]})}),e.jsx(n,{asChild:!0,className:"text-indigo-600",children:e.jsxs(o,{href:`/template-editor-with-layers/${s.id}`,children:[e.jsx("svg",{className:"h-4 w-4 ml-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:e.jsx("path",{d:"M6 3h12M6 15h12M6 11h12M6 7h12M6 19h12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),e.jsx("span",{className:"flex-1",children:"محرر الطبقات القياسي"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-indigo-500/10 text-indigo-500",children:"مستقر"})]})}),e.jsx(n,{asChild:!0,className:"text-green-600",children:e.jsxs(o,{href:`/advanced-layer-editor/${s.id}`,children:[e.jsx(pe,{className:"h-4 w-4 ml-2"}),e.jsx("span",{className:"flex-1",children:"محرر الطبقات المتقدم"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-green-500/10 text-green-500",children:"جديد"})]})}),e.jsx(n,{asChild:!0,className:"text-blue-600",children:e.jsxs(o,{href:`/social-template-editor/${s.id}`,children:[e.jsxs("svg",{width:"16",height:"16",className:"ml-2",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[e.jsx("path",{d:"M18 2H6a4 4 0 0 0-4 4v12a4 4 0 0 0 4 4h12a4 4 0 0 0 4-4V6a4 4 0 0 0-4-4Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10 12a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM16 9a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM17 15a2 2 0 1 1-4 0 2 2 0 0 1 4 0Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"m8.5 13.5 5-3M12.5 11.5l2 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),e.jsx("span",{className:"flex-1",children:"محرر الشبكات الاجتماعية"}),e.jsx("span",{className:"px-1.5 py-0.5 rounded text-[10px] bg-blue-500/10 text-blue-500",children:"ميزة متقدمة"})]})}),e.jsxs(n,{className:"text-destructive focus:text-destructive",onClick:()=>f(s.id),children:[e.jsx(ge,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"لا توجد قوالب متطابقة مع معايير البحث"})})]})}export{Qe as default};
