import{n as Z,h as le,r as m,b as ce,i as P,j as e,c as S,B as t,C as de,s as oe,t as me,v as he,d as xe,U as z,K as je,N as ue,O as pe,P as ve,Q as ge,V as U,Y as E,Z as q,_ as ye}from"./index-DoMHCGG2.js";import{I as r}from"./input-COMsjQRu.js";import{L as n}from"./label-DSWK9Bhr.js";import{S as O}from"./switch-DKvoDZdm.js";import{D as I,b as Q,c as A,d as V,e as H,f as K}from"./dialog-fsPDLJiu.js";import{S as B,a as R,b as X,c as $,d as D}from"./select-CRu623qS.js";import{T as fe,a as Ce,b as f,c as we}from"./tabs-CKJmMpcu.js";import{T as Ne,a as be,b as W,c as h,d as Se,e as x}from"./table-I-YXpiuN.js";import{U as De}from"./user-plus-BHXitpu0.js";import{S as Fe}from"./search-CdLD-xpV.js";import{E as ke}from"./ellipsis-vertical-CjI7CaMN.js";import{P as Te}from"./pencil-w_OmdVc4.js";import"./index-BdQq_4o_.js";import"./chevron-up-DgjV3eGa.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=Z("ShieldAlert",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M12 8v4",key:"1got3b"}],["path",{d:"M12 16h.01",key:"1drbdi"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Le=Z("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);function Re(){const{toast:j}=le(),[y,_]=m.useState(""),[l,G]=m.useState("all"),[J,C]=m.useState(!1),[ee,w]=m.useState(!1),[se,N]=m.useState(!1),[c,F]=m.useState(null),[a,d]=m.useState({username:"",email:"",name:"",password:"",role:"user",active:!0}),{data:u,isLoading:ae}=ce({queryKey:["/api/admin/users"],queryFn:ye({})}),p=(u==null?void 0:u.users)||[];u!=null&&u.total;const k=p.filter(s=>{const i=y?s.username.toLowerCase().includes(y.toLowerCase())||s.email.toLowerCase().includes(y.toLowerCase())||s.name&&s.name.toLowerCase().includes(y.toLowerCase()):!0,g=l==="all"||l==="active"&&s.active||l==="inactive"&&!s.active||l==="admin"&&s.role==="admin"||l==="user"&&s.role==="user";return i&&g}),T=P({mutationFn:async s=>(await E("POST","/api/register",s)).json(),onSuccess:()=>{q.invalidateQueries({queryKey:["/api/admin/users"]}),C(!1),b(),j({title:"تم إنشاء المستخدم بنجاح"})},onError:s=>{j({title:"فشل إنشاء المستخدم",description:s.message,variant:"destructive"})}}),v=P({mutationFn:async({id:s,data:i})=>(await E("PUT",`/api/admin/users/${s}`,i)).json(),onSuccess:()=>{q.invalidateQueries({queryKey:["/api/admin/users"]}),w(!1),b(),j({title:"تم تحديث المستخدم بنجاح"})},onError:s=>{j({title:"فشل تحديث المستخدم",description:s.message,variant:"destructive"})}}),L=P({mutationFn:async s=>{await E("DELETE",`/api/admin/users/${s}`)},onSuccess:()=>{q.invalidateQueries({queryKey:["/api/admin/users"]}),N(!1),F(null),j({title:"تم حذف المستخدم بنجاح"})},onError:s=>{j({title:"فشل حذف المستخدم",description:s.message,variant:"destructive"})}}),b=()=>{d({username:"",email:"",name:"",password:"",role:"user",active:!0})},o=s=>{const{name:i,value:g,type:M,checked:te}=s.target;d(re=>({...re,[i]:M==="checkbox"?te:g}))},ne=s=>{F(s),d({username:s.username,email:s.email,name:s.name||"",password:"",role:s.role,active:s.active}),w(!0)},ie=s=>{F(s),N(!0)};return ae?e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(S,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"المستخدمون"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة مستخدمي النظام"})]}),e.jsxs(t,{onClick:()=>C(!0),children:[e.jsx(De,{className:"h-4 w-4 ml-2"}),"إضافة مستخدم"]})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(Fe,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(r,{placeholder:"البحث في المستخدمين...",className:"pr-9",value:y,onChange:s=>_(s.target.value)})]})}),e.jsxs(fe,{value:l,onValueChange:G,children:[e.jsxs(Ce,{children:[e.jsxs(f,{value:"all",children:["الكل (",p.length,")"]}),e.jsxs(f,{value:"active",children:["نشط (",p.filter(s=>s.active).length,")"]}),e.jsxs(f,{value:"inactive",children:["غير نشط (",p.filter(s=>!s.active).length,")"]}),e.jsxs(f,{value:"admin",children:["مدير (",p.filter(s=>s.role==="admin").length,")"]}),e.jsxs(f,{value:"user",children:["مستخدم (",p.filter(s=>s.role==="user").length,")"]})]}),e.jsx(we,{value:l,className:"mt-4",children:e.jsxs(de,{children:[e.jsxs(oe,{className:"pb-3",children:[e.jsx(me,{children:"المستخدمون"}),e.jsxs(he,{children:["عدد المستخدمين المعروضين: ",k.length]})]}),e.jsx(xe,{children:k.length?e.jsx("div",{className:"border rounded-md",children:e.jsxs(Ne,{children:[e.jsx(be,{children:e.jsxs(W,{children:[e.jsx(h,{children:"اسم المستخدم"}),e.jsx(h,{children:"البريد الإلكتروني"}),e.jsx(h,{children:"الدور"}),e.jsx(h,{className:"text-center",children:"الحالة"}),e.jsx(h,{children:"تاريخ التسجيل"}),e.jsx(h,{children:"آخر تسجيل دخول"}),e.jsx(h,{className:"w-12"})]})}),e.jsx(Se,{children:k.map(s=>e.jsxs(W,{children:[e.jsxs(x,{children:[e.jsx("div",{className:"font-medium",children:s.username}),s.name&&e.jsx("div",{className:"text-sm text-muted-foreground",children:s.name})]}),e.jsx(x,{children:s.email}),e.jsx(x,{children:e.jsx("div",{className:"flex items-center gap-2",children:s.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 text-primary"}),e.jsx("span",{children:"مدير"})]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{children:"مستخدم"})]})})}),e.jsx(x,{className:"text-center",children:e.jsx(O,{checked:s.active,onCheckedChange:i=>v.mutate({id:s.id,data:{active:i}}),disabled:v.isPending})}),e.jsx(x,{children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx(x,{children:s.lastLogin?new Date(s.lastLogin).toLocaleDateString("ar-SA"):"لا يوجد"}),e.jsx(x,{children:e.jsxs(je,{children:[e.jsx(ue,{asChild:!0,children:e.jsx(t,{variant:"ghost",size:"icon",children:e.jsx(ke,{className:"h-4 w-4"})})}),e.jsxs(pe,{align:"end",children:[e.jsx(ve,{children:"خيارات"}),e.jsx(ge,{}),e.jsxs(U,{onClick:()=>ne(s),children:[e.jsx(Te,{className:"h-4 w-4 ml-2"}),"تعديل"]}),e.jsx(U,{onClick:()=>v.mutate({id:s.id,data:{role:s.role==="admin"?"user":"admin"}}),children:s.role==="admin"?e.jsxs(e.Fragment,{children:[e.jsx(z,{className:"h-4 w-4 ml-2"}),"تغيير إلى مستخدم"]}):e.jsxs(e.Fragment,{children:[e.jsx(Y,{className:"h-4 w-4 ml-2"}),"تغيير إلى مدير"]})}),e.jsxs(U,{onClick:()=>ie(s),className:"text-destructive focus:text-destructive",children:[e.jsx(Le,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})})]},s.id))})]})}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"لا يوجد مستخدمين متطابقين مع معايير البحث"})})]})})]}),e.jsx(I,{open:J,onOpenChange:C,children:e.jsxs(Q,{children:[e.jsxs(A,{children:[e.jsx(V,{children:"إضافة مستخدم جديد"}),e.jsx(H,{children:"أضف مستخدمًا جديدًا إلى النظام."})]}),e.jsxs("form",{onSubmit:s=>{s.preventDefault(),T.mutate(a)},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"username",children:"اسم المستخدم"}),e.jsx(r,{id:"username",name:"username",value:a.username,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(r,{id:"email",name:"email",type:"email",value:a.email,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"name",children:"الاسم الكامل (اختياري)"}),e.jsx(r,{id:"name",name:"name",value:a.name,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"password",children:"كلمة المرور"}),e.jsx(r,{id:"password",name:"password",type:"password",value:a.password,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"role",children:"الدور"}),e.jsxs(B,{value:a.role,onValueChange:s=>d({...a,role:s}),children:[e.jsx(R,{children:e.jsx(X,{placeholder:"اختر الدور"})}),e.jsxs($,{children:[e.jsx(D,{value:"user",children:"مستخدم"}),e.jsx(D,{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(O,{id:"active",checked:a.active,onCheckedChange:s=>d({...a,active:s})}),e.jsx(n,{htmlFor:"active",children:"نشط"})]}),e.jsxs(K,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{C(!1),b()},children:"إلغاء"}),e.jsx(t,{type:"submit",disabled:T.isPending,children:T.isPending?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الإضافة..."]}):"إضافة المستخدم"})]})]})]})}),e.jsx(I,{open:ee,onOpenChange:w,children:e.jsxs(Q,{children:[e.jsxs(A,{children:[e.jsx(V,{children:"تعديل المستخدم"}),e.jsx(H,{children:"تعديل بيانات المستخدم."})]}),e.jsxs("form",{onSubmit:s=>{if(s.preventDefault(),c){const{password:i,...g}=a,M=i?a:g;v.mutate({id:c.id,data:M})}},className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-email",children:"البريد الإلكتروني"}),e.jsx(r,{id:"edit-email",name:"email",type:"email",value:a.email,onChange:o,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-name",children:"الاسم الكامل (اختياري)"}),e.jsx(r,{id:"edit-name",name:"name",value:a.name,onChange:o})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-password",children:"كلمة المرور (اتركها فارغة للإبقاء على الحالية)"}),e.jsx(r,{id:"edit-password",name:"password",type:"password",value:a.password,onChange:o,placeholder:"اتركها فارغة للإبقاء على كلمة المرور الحالية"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{htmlFor:"edit-role",children:"الدور"}),e.jsxs(B,{value:a.role,onValueChange:s=>d({...a,role:s}),children:[e.jsx(R,{children:e.jsx(X,{placeholder:"اختر الدور"})}),e.jsxs($,{children:[e.jsx(D,{value:"user",children:"مستخدم"}),e.jsx(D,{value:"admin",children:"مدير"})]})]})]}),e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(O,{id:"edit-active",checked:a.active,onCheckedChange:s=>d({...a,active:s})}),e.jsx(n,{htmlFor:"edit-active",children:"نشط"})]}),e.jsxs(K,{children:[e.jsx(t,{type:"button",variant:"outline",onClick:()=>{w(!1),b()},children:"إلغاء"}),e.jsx(t,{type:"submit",disabled:v.isPending,children:v.isPending?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحديث..."]}):"تحديث"})]})]})]})}),e.jsx(I,{open:se,onOpenChange:N,children:e.jsxs(Q,{children:[e.jsxs(A,{children:[e.jsx(V,{children:"حذف المستخدم"}),e.jsx(H,{children:"هل أنت متأكد من رغبتك في حذف هذا المستخدم؟ سيؤدي ذلك إلى حذف جميع البيانات المرتبطة به."})]}),e.jsxs("div",{className:"py-4",children:[e.jsxs("p",{className:"font-medium",children:["المستخدم: ",c==null?void 0:c.username]}),e.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:"لا يمكن التراجع عن هذا الإجراء."})]}),e.jsxs(K,{children:[e.jsx(t,{variant:"outline",onClick:()=>N(!1),children:"إلغاء"}),e.jsx(t,{variant:"destructive",onClick:()=>c&&L.mutate(c.id),disabled:L.isPending,children:L.isPending?e.jsxs(e.Fragment,{children:[e.jsx(S,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد الحذف"})]})]})})]})}export{Re as default};
