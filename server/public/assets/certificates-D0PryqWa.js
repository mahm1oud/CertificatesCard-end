import{h as J,r,b as X,i as E,j as e,c as v,B as n,L as F,C as Z,d as ee,e as se,K as ae,N as te,O as ie,V as C,Q as re,A as ne,M as le,m as ce,l as I,W as oe,g as de}from"./index-DoMHCGG2.js";import{I as N}from"./input-COMsjQRu.js";import{D as M,b as O,c as $,d as A,e as Q,f as q}from"./dialog-fsPDLJiu.js";import{T as me,a as ue,b as w,c as xe}from"./tabs-CKJmMpcu.js";import{S as he}from"./search-CdLD-xpV.js";import{D as je}from"./download-CkzZtpS5.js";import{E as pe}from"./ellipsis-vertical-CjI7CaMN.js";import{Q as fe}from"./qr-code-BYf2XRjA.js";import{S as ge}from"./share-2-C3FB-j83.js";import{T as ve}from"./trash-2-Dn6YYs7e.js";import{C as Ce}from"./copy-DCUs-YoJ.js";function $e(){const{toast:c}=J(),[o,P]=r.useState(""),[d,U]=r.useState("all"),[V,u]=r.useState(!1),[B,x]=r.useState(!1),[t,f]=r.useState(null),[Ne,y]=r.useState(!1),[b,D]=r.useState(!1),[h,S]=r.useState(""),[we,T]=r.useState(!1),{data:j,isLoading:K}=X({queryKey:["/api/user/certificates"],queryFn:de({on401:"redirect-to-login"})}),p=Array.isArray(j==null?void 0:j.certificates)?j.certificates:[],g=E({mutationFn:async s=>{await I("DELETE",`/api/certificates/${s}`)},onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/user/certificates"]}),x(!1),f(null),c({title:"تم حذف الشهادة بنجاح"})},onError:s=>{c({title:"فشل حذف الشهادة",description:s.message,variant:"destructive"})}}),z=E({mutationFn:async s=>(await I("POST","/api/certificates/share-email",s)).json(),onSuccess:()=>{u(!1),S(""),c({title:"تم مشاركة الشهادة بنجاح",description:"تم إرسال الشهادة إلى البريد الإلكتروني المحدد"})},onError:s=>{c({title:"فشل مشاركة الشهادة",description:s.message,variant:"destructive"})}}),R=s=>{y(!0),ce(s.imageUrl,`شهادة_${s.issuedTo||s.id}.png`).finally(()=>{y(!1)})},L=s=>{const i=`${window.location.origin}/certificates/verify/${s}`;navigator.clipboard.writeText(i),T(!0),c({title:"تم نسخ رابط التحقق",description:"تم نسخ رابط التحقق إلى الحافظة"}),setTimeout(()=>T(!1),2e3)},H=s=>{f(s),u(!0)},W=s=>{f(s),x(!0)},Y=s=>{switch(s){case"appreciation":return"شهادة تقدير";case"training":return"شهادة تدريب";case"education":return"شهادة تعليم";case"teacher":return"شهادة معلم";default:return s}},k=p.filter(s=>{const i=o?s.title.toLowerCase().includes(o.toLowerCase())||s.issuedTo&&s.issuedTo.toLowerCase().includes(o.toLowerCase())||s.verificationCode.toLowerCase().includes(o.toLowerCase()):!0,l=d==="all"||d==="active"&&s.status==="active"||d==="expired"&&s.status==="expired";return i&&l}).reduce((s,i)=>{const l=new Date(i.createdAt),m=`${l.getMonth()}-${l.getFullYear()}`;return s[m]||(s[m]=[]),s[m].push(i),s},{});return K?e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(v,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"شهاداتي"}),e.jsx("p",{className:"text-muted-foreground",children:"الشهادات التي تم إصدارها لك"})]}),e.jsx(n,{asChild:!0,children:e.jsx(F,{href:"/#templates?tab=certificates",children:"إنشاء شهادة جديدة"})})]}),e.jsxs("div",{className:"relative max-w-sm",children:[e.jsx(he,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(N,{placeholder:"البحث في الشهادات...",className:"pr-9",value:o,onChange:s=>P(s.target.value)})]}),e.jsxs(me,{value:d,onValueChange:U,children:[e.jsxs(ue,{children:[e.jsxs(w,{value:"all",children:["الكل (",p.length||0,")"]}),e.jsxs(w,{value:"active",children:["نشطة (",p.filter(s=>s.status==="active").length||0,")"]}),e.jsxs(w,{value:"expired",children:["منتهية (",p.filter(s=>s.status==="expired").length||0,")"]})]}),e.jsx(xe,{value:d,className:"mt-6",children:Object.keys(k).length>0?e.jsx("div",{className:"space-y-8",children:Object.entries(k).map(([s,i])=>{const[l,m]=s.split("-").map(Number),_=new Date(m,l),G=new Intl.DateTimeFormat("ar-SA",{year:"numeric",month:"long"}).format(_);return e.jsxs("div",{className:"space-y-4",children:[e.jsx("h2",{className:"text-xl font-semibold",children:G}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(a=>e.jsxs(Z,{className:"overflow-hidden",children:[e.jsx("div",{className:"aspect-video w-full overflow-hidden bg-muted",children:e.jsx("img",{src:a.imageUrl,alt:`شهادة ${a.issuedTo||a.id}`,className:"w-full h-full object-cover hover:scale-105 transition-transform duration-300"})}),e.jsxs(ee,{className:"p-4",children:[e.jsxs("div",{className:"flex justify-between items-start mb-2",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium",children:a.title}),a.issuedTo&&e.jsx("p",{className:"text-sm text-muted-foreground",children:a.issuedTo})]}),e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${a.status==="active"?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:a.status==="active"?"نشطة":"منتهية"})]}),e.jsxs("div",{className:"flex items-center justify-between mt-2",children:[e.jsx("div",{className:"text-sm text-muted-foreground",children:Y(a.certificateType)}),e.jsx("div",{className:"text-sm text-muted-foreground",children:new Date(a.createdAt).toLocaleDateString("ar-SA")})]})]}),e.jsxs(se,{className:"p-4 pt-0 flex justify-between",children:[e.jsxs(n,{variant:"outline",size:"sm",onClick:()=>R(a),children:[e.jsx(je,{className:"h-4 w-4 ml-1"}),"تحميل"]}),e.jsxs(ae,{children:[e.jsx(te,{asChild:!0,children:e.jsxs(n,{variant:"outline",size:"sm",children:[e.jsx(pe,{className:"h-4 w-4 ml-1"}),"خيارات"]})}),e.jsxs(ie,{align:"end",children:[e.jsxs(C,{onClick:()=>L(a.verificationCode),children:[e.jsx(fe,{className:"h-4 w-4 ml-2"}),"نسخ رابط التحقق"]}),e.jsxs(C,{onClick:()=>H(a),children:[e.jsx(ge,{className:"h-4 w-4 ml-2"}),"مشاركة"]}),e.jsx(re,{}),e.jsxs(C,{onClick:()=>W(a),className:"text-destructive focus:text-destructive",children:[e.jsx(ve,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})]})]},a.id))})]},s)})}):e.jsxs("div",{className:"text-center py-16",children:[e.jsx(ne,{className:"h-12 w-12 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد شهادات حتى الآن"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"لم يتم إصدار أي شهادات لك بعد"}),e.jsx(n,{asChild:!0,children:e.jsx(F,{href:"/#templates?tab=certificates",children:"استكشاف القوالب"})})]})})]}),e.jsx(M,{open:V,onOpenChange:u,children:e.jsxs(O,{children:[e.jsxs($,{children:[e.jsx(A,{children:"مشاركة الشهادة"}),e.jsx(Q,{children:"مشاركة الشهادة عبر البريد الإلكتروني أو وسائل التواصل الاجتماعي."})]}),e.jsxs("div",{className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("h3",{className:"font-medium",children:"رابط التحقق"}),e.jsxs("div",{className:"flex",children:[e.jsx(N,{readOnly:!0,value:t?`${window.location.origin}/certificates/verify/${t.verificationCode}`:"",className:"flex-1 ml-2"}),e.jsx(n,{variant:"outline",onClick:()=>t&&L(t.verificationCode),children:e.jsx(Ce,{className:"h-4 w-4"})})]}),e.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"يمكن لأي شخص التحقق من صحة الشهادة باستخدام هذا الرابط"})]}),e.jsxs("div",{className:"space-y-2 mt-6",children:[e.jsx("h3",{className:"font-medium",children:"مشاركة عبر البريد الإلكتروني"}),e.jsxs("div",{className:"space-y-4",children:[e.jsx(N,{placeholder:"أدخل البريد الإلكتروني للمستلم",type:"email",value:h,onChange:s=>S(s.target.value)}),e.jsx(n,{onClick:()=>{t&&h&&(D(!0),z.mutate({certificateId:t.id,email:h},{onSettled:()=>D(!1)}))},disabled:!h||b,className:"w-full",children:b?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الإرسال..."]}):e.jsxs(e.Fragment,{children:[e.jsx(le,{className:"ml-2 h-4 w-4"}),"إرسال"]})})]})]})]}),e.jsx(q,{children:e.jsx(n,{variant:"outline",onClick:()=>u(!1),children:"إغلاق"})})]})}),e.jsx(M,{open:B,onOpenChange:x,children:e.jsxs(O,{children:[e.jsxs($,{children:[e.jsx(A,{children:"حذف الشهادة"}),e.jsx(Q,{children:"هل أنت متأكد من رغبتك في حذف هذه الشهادة؟ هذا الإجراء لا يمكن التراجع عنه."})]}),e.jsxs("div",{className:"py-4",children:[t&&e.jsx("div",{className:"aspect-video w-[200px] h-[120px] mx-auto overflow-hidden rounded-md border",children:e.jsx("img",{src:t.imageUrl,alt:"الشهادة",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6 text-center",children:"سيتم حذف الشهادة نهائياً ولن تتمكن من استعادتها."})]}),e.jsxs(q,{children:[e.jsx(n,{variant:"outline",onClick:()=>x(!1),children:"إلغاء"}),e.jsx(n,{variant:"destructive",onClick:()=>t&&g.mutate(t.id),disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(v,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد الحذف"})]})]})})]})}export{$e as default};
