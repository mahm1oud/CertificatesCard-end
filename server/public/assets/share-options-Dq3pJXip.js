import{j as e,w as H,a7 as R,u as W,r as d,b as J,R as S,C,d as k,B as l,L as X,a6 as Y,l as L,i as $,c as D,k as Z,m as q}from"./index-DoMHCGG2.js";import{S as K}from"./scroll-area-BaWF6YIt.js";import{D as ee,b as se,c as ae,d as te,e as ie}from"./dialog-fsPDLJiu.js";import{T as re,a as ne,b as le,c as ce}from"./tabs-CKJmMpcu.js";import{I as oe}from"./image-CRCqvbIG.js";import{F as O,T as P}from"./twitter-BkFCnlyo.js";import{I as de}from"./instagram-BWPAtAad.js";import{S as U}from"./share-2-C3FB-j83.js";import{Q as me}from"./qr-code-BYf2XRjA.js";import{C as he}from"./copy-DCUs-YoJ.js";import{D as I}from"./download-CkzZtpS5.js";function Q({className:c,...h}){return e.jsx("div",{className:H("animate-pulse rounded-md bg-muted",c),...h})}const xe=({onFormatSelect:c,selectedFormat:h,cardImageUrl:x,onGenerateImage:f,templateId:t})=>{const{t:m}=R(),{user:p}=W(),[i,w]=d.useState(h||"instagram"),{data:o,isLoading:b,error:n}=J({queryKey:["/api/social-formats"],queryFn:()=>L("GET","/api/social-formats")}),N=s=>{w(s)},v=()=>{if(o!=null&&o.formats&&i){const s=o.formats[i];s&&c(i,s)}else if(u&&i){const s=u[i];s&&c(i,s)}};d.useEffect(()=>{w(h||"instagram")},[o]);const u=S.useMemo(()=>({instagram:{width:1080,height:1080,ratio:"1:1",description:"Instagram (Square)"},instagramStory:{width:1080,height:1920,ratio:"9:16",description:"Instagram Story"},facebook:{width:1200,height:630,ratio:"1.91:1",description:"Facebook"},twitter:{width:1200,height:675,ratio:"16:9",description:"Twitter"},whatsapp:{width:800,height:800,ratio:"1:1",description:"WhatsApp"},pinterest:{width:1e3,height:1500,ratio:"2:3",description:"Pinterest"}}),[]),r=(o==null?void 0:o.formats)||u,j=s=>{switch(s){case"instagram":case"instagramStory":return e.jsx(de,{className:"h-4 w-4"});case"twitter":return e.jsx(P,{className:"h-4 w-4"});case"facebook":return e.jsx(O,{className:"h-4 w-4"});default:return e.jsx(oe,{className:"h-4 w-4"})}};return b?e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(Q,{className:"h-10 w-full"}),e.jsx(Q,{className:"h-32 w-full"})]})})}):n?e.jsx(C,{children:e.jsx(k,{className:"p-4",children:e.jsx("p",{className:"text-red-500",children:m("errors.loadingFormats")})})}):e.jsx(C,{children:e.jsxs(k,{className:"p-4",children:[e.jsx("h3",{className:"text-lg font-medium mb-3",children:m("socialMediaFormats.title")}),e.jsxs(re,{value:i,onValueChange:N,children:[e.jsx(ne,{className:"mb-4 grid grid-cols-3 sm:grid-cols-6",children:Object.keys(r).map(s=>e.jsxs(le,{value:s,className:"flex items-center gap-1",children:[j(s),e.jsx("span",{className:"hidden sm:inline",children:r[s].description.split(" ")[0]})]},s))}),Object.keys(r).map(s=>e.jsx(ce,{value:s,children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 max-h-[500px] overflow-y-auto overflow-x-hidden scrollbar-thin scrollbar-thumb-gray-300 scrollbar-track-gray-100 p-1",children:[e.jsx("div",{className:"flex-1",children:e.jsxs("div",{className:"bg-muted p-3 rounded-md",children:[e.jsx("div",{className:"text-sm mb-1",children:r[s].description}),e.jsxs("div",{className:"text-xs text-muted-foreground",children:[r[s].width," x ",r[s].height," px (",r[s].ratio,")"]}),e.jsxs("div",{className:"mt-3 space-y-2",children:[e.jsx(l,{className:"w-full",onClick:()=>{f?f():v()},children:m("share.generate")}),t&&(p==null?void 0:p.role)==="admin"&&e.jsx(l,{variant:"outline",size:"sm",className:"w-full flex items-center gap-1 text-blue-600",asChild:!0,children:e.jsxs(X,{href:`/social-template-editor/${t}`,children:[e.jsx(Y,{className:"h-4 w-4"}),m("share.socialEditor")||"محرر الشبكات الاجتماعية"]})})]})]})}),x&&e.jsxs("div",{className:"flex-1",children:[e.jsx("div",{className:"bg-muted rounded-md flex items-center justify-center overflow-hidden",style:{maxWidth:"300px",maxHeight:"300px",aspectRatio:r[s].ratio.replace(":","/")},children:e.jsx("img",{src:x,alt:"Preview",className:"max-w-full max-h-full object-contain"})}),e.jsx(l,{variant:"outline",size:"sm",className:"mt-2",onClick:()=>window.open(x,"_blank"),children:m("share.preview")})]})]})},s))]})]})})},Se=({cardId:c,imageUrl:h,size:x="default",templateId:f})=>{const{t}=R(),[m,p]=d.useState(!1),[i,w]=d.useState("instagram"),[o,b]=d.useState(null),[n,N]=d.useState(null),[v,u]=d.useState("idle"),[r,j]=d.useState(!1),[s,E]=d.useState(null),{mutate:y,isPending:T}=$({mutationFn:async({format:a})=>L("POST",`/api/cards/${c}/social`,{format:a,options:{quality:"high",watermark:!1}}),onSuccess:a=>{a&&a.imageUrl&&N(a.imageUrl)}}),{mutate:M,isPending:F}=$({mutationFn:async()=>{const a=`${window.location.origin}/view/${c}`;return{qrCodeUrl:`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(a)}`}},onSuccess:a=>{a&&a.qrCodeUrl&&(E(a.qrCodeUrl),j(!0))}}),A=S.useCallback((a,g)=>{w(a),b(g),N(null)},[]),V=S.useCallback(()=>{i&&y({format:i})},[i,y]),_=()=>{if(n){const a=`${window.location.origin}${n}`;navigator.clipboard.writeText(a).then(()=>{u("copied"),setTimeout(()=>u("idle"),3e3)}).catch(g=>{console.error("Could not copy text: ",g)})}},z=()=>{if(n){const a=`card-${i}-${c}.png`;q(n,a)}},B=()=>{if(n){const a=encodeURIComponent(`${window.location.origin}${n}`);window.open(`https://www.facebook.com/sharer/sharer.php?u=${a}`,"_blank")}},G=()=>{if(n){const a=encodeURIComponent(`${window.location.origin}${n}`),g=encodeURIComponent(t("share.twitterText"));window.open(`https://twitter.com/intent/tweet?url=${a}&text=${g}`,"_blank")}};return e.jsxs(e.Fragment,{children:[e.jsxs(l,{variant:"outline",size:x,className:"flex items-center gap-1",onClick:()=>p(!0),children:[e.jsx(U,{className:"h-4 w-4"}),x==="sm"?"":t("share.share")]}),e.jsx(ee,{open:m,onOpenChange:p,children:e.jsxs(se,{className:"sm:max-w-[600px] max-h-[90vh]",children:[e.jsxs(ae,{children:[e.jsx(te,{children:t("share.title")}),e.jsx(ie,{children:t("share.description")})]}),e.jsx(K,{className:"max-h-[calc(90vh-160px)] pr-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex flex-row gap-4 mb-4",children:[e.jsxs(l,{variant:r?"outline":"default",className:"flex-1 flex justify-center items-center gap-2",onClick:()=>{j(!1)},children:[e.jsx(U,{className:"h-4 w-4"}),t("share.socialMedia")]}),e.jsxs(l,{variant:r?"default":"outline",className:"flex-1 flex justify-center items-center gap-2",onClick:()=>{j(!0),s||M()},children:[e.jsx(me,{className:"h-4 w-4"}),t("share.qrCode")]})]}),!r&&e.jsxs(e.Fragment,{children:[e.jsx(xe,{onFormatSelect:A,selectedFormat:i,cardImageUrl:h,onGenerateImage:V,templateId:f}),T&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(D,{className:"w-6 h-6 animate-spin text-primary"})}),n&&!T&&e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:t("share.preview")}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:n,alt:"Social Media Version",className:"max-w-full max-h-[300px] object-contain"})})]}),e.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[e.jsxs(l,{variant:"outline",className:"flex items-center gap-2",onClick:_,children:[v==="copied"?e.jsx(Z,{className:"h-4 w-4 text-green-500"}):e.jsx(he,{className:"h-4 w-4"}),t(v==="copied"?"share.copied":"share.copyLink")]}),e.jsxs(l,{variant:"outline",className:"flex items-center gap-2",onClick:z,children:[e.jsx(I,{className:"h-4 w-4"}),t("share.download")]}),e.jsxs(l,{variant:"outline",className:"flex items-center gap-2 bg-[#1877F2] text-white hover:bg-[#0b5ed7]",onClick:B,children:[e.jsx(O,{className:"h-4 w-4"}),t("share.facebook")]}),e.jsxs(l,{variant:"outline",className:"flex items-center gap-2 bg-[#1DA1F2] text-white hover:bg-[#0c85d0]",onClick:G,children:[e.jsx(P,{className:"h-4 w-4"}),t("share.twitter")]})]})]})]}),r&&e.jsxs("div",{className:"space-y-4",children:[F&&e.jsx("div",{className:"flex justify-center p-4",children:e.jsx(D,{className:"w-6 h-6 animate-spin text-primary"})}),s&&!F&&e.jsxs(e.Fragment,{children:[e.jsxs("div",{className:"border rounded-md p-4",children:[e.jsx("div",{className:"text-sm font-medium mb-2",children:t("share.qrCodePreview")}),e.jsx("div",{className:"flex justify-center",children:e.jsx("img",{src:s,alt:"QR Code",className:"max-w-full max-h-[300px] object-contain"})}),e.jsx("div",{className:"text-xs text-center mt-2 text-gray-500",children:t("share.qrCodeDescription")})]}),e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:e.jsxs(l,{variant:"outline",className:"flex items-center gap-2 sm:col-span-2",onClick:()=>q(s,`qrcode-${c}.png`),children:[e.jsx(I,{className:"h-4 w-4"}),t("share.downloadQrCode")]})})]})]})]})})]})})]})};export{Se as S,Q as a};
