import{n as J,q as I,b as K,l as k,i as F,h as z,r as v,j as e,w as $,B as h,x as me,C as B,d as H,e as ae,S as ue,a5 as xe}from"./index-DoMHCGG2.js";import{T as W,a as Z,b as P,c as T}from"./tabs-CKJmMpcu.js";import{A as he,a as pe,b as je,c as ge}from"./accordion-Chl2UIcD.js";import{I as q}from"./input-COMsjQRu.js";import{S as O,a as M,b as Q,c as R,d as b}from"./select-CRu623qS.js";import{C as fe}from"./chevron-up-DgjV3eGa.js";import{T as X}from"./trash-2-Dn6YYs7e.js";import{P as ve}from"./plus-B2are30l.js";import{T as _}from"./type-DWs-uHqd.js";import{I as V}from"./image-CRCqvbIG.js";import{D as te,a as re,b as le,c as ie,d as ne,e as ce,f as de}from"./dialog-fsPDLJiu.js";import{U as oe}from"./upload-EyRwM4Gj.js";import{A as ye}from"./arrow-left-BN8mgSLP.js";import{U as Ne,R as be}from"./undo-CkcTi4oW.js";import{S as we}from"./save-CRRscGsZ.js";import{L as Se}from"./layers-D3_CD2xn.js";import"./index-BdQq_4o_.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ce=J("ImagePlus",[["path",{d:"M16 5h6",key:"1vod17"}],["path",{d:"M19 2v6",key:"4bpg5p"}],["path",{d:"M21 11.5V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h7.5",key:"1ue2ih"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ee=J("Pen",[["path",{d:"M21.174 6.812a1 1 0 0 0-3.986-3.987L3.842 16.174a2 2 0 0 0-.5.83l-1.321 4.352a.5.5 0 0 0 .623.622l4.353-1.32a2 2 0 0 0 .83-.497z",key:"1a8usu"}]]);/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=J("Stamp",[["path",{d:"M5 22h14",key:"ehvnwv"}],["path",{d:"M19.27 13.73A2.5 2.5 0 0 0 17.5 13h-11A2.5 2.5 0 0 0 4 15.5V17a1 1 0 0 0 1 1h14a1 1 0 0 0 1-1v-1.5c0-.66-.26-1.3-.73-1.77Z",key:"1sy9ra"}],["path",{d:"M14 13V8.5C14 7 15 7 15 5a3 3 0 0 0-3-3c-1.66 0-3 1-3 3s1 2 1 3.5V13",key:"cnxgux"}]]),Le=r=>{const i=I(),l=K({queryKey:["/api/layers",r],queryFn:()=>k(`/api/layers/template/${r}`)}),o=F({mutationFn:n=>k("/api/layers",{method:"POST",body:JSON.stringify(n)}),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/layers",r]})}}),c=F({mutationFn:({id:n,...x})=>k(`/api/layers/${n}`,{method:"PATCH",body:JSON.stringify(x)}),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/layers",r]})}}),m=F({mutationFn:n=>k(`/api/layers/${n}`,{method:"DELETE"}),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/layers",r]})}}),p=F({mutationFn:n=>k("/api/layers/reorder",{method:"POST",body:JSON.stringify({layerIds:n,templateId:r})}),onSuccess:()=>{i.invalidateQueries({queryKey:["/api/layers",r]})}});return{layers:l,createLayer:o,updateLayer:c,deleteLayer:m,reorderLayers:p}};function ke({templateId:r,onSelectLayer:i,onUpdateLayerPosition:l,onToggleLayerVisibility:o,selectedLayerId:c}){const{layers:m,updateLayer:p,createLayer:n,deleteLayer:x,reorderLayers:C}=Le(r),{toast:j}=z(),[f,y]=v.useState([]),[g,w]=v.useState({name:"",type:"field",templateId:r});v.useEffect(()=>{c&&!f.includes(c.toString())&&y(a=>[...a,c.toString()])},[c]);const S=a=>{i&&i(a)},L=(a,d)=>{p.mutate({id:a,...d},{onSuccess:()=>{j({title:"تم التحديث",description:"تم تحديث الطبقة بنجاح"})},onError:()=>{j({title:"خطأ",description:"حدث خطأ أثناء تحديث الطبقة",variant:"destructive"})}})},U=a=>{x.mutate(a,{onSuccess:()=>{j({title:"تم الحذف",description:"تم حذف الطبقة بنجاح"})},onError:()=>{j({title:"خطأ",description:"حدث خطأ أثناء حذف الطبقة",variant:"destructive"})}})},E=()=>{if(!g.name){j({title:"خطأ",description:"الرجاء إدخال اسم للطبقة",variant:"destructive"});return}n.mutate({...g,templateId:r},{onSuccess:()=>{j({title:"تم الإنشاء",description:"تم إنشاء الطبقة بنجاح"}),w({name:"",type:"field",templateId:r})},onError:()=>{j({title:"خطأ",description:"حدث خطأ أثناء إنشاء الطبقة",variant:"destructive"})}})},N=(a,d)=>{if(!m.data)return;const u=[...m.data];if(a==="up"&&d>0)[u[d],u[d-1]]=[u[d-1],u[d]];else if(a==="down"&&d<u.length-1)[u[d],u[d+1]]=[u[d+1],u[d]];else return;C.mutate(u.map(t=>t.id),{onError:()=>{j({title:"خطأ",description:"حدث خطأ أثناء إعادة ترتيب الطبقات",variant:"destructive"})}})},s=a=>{switch(a){case"field":return e.jsx(_,{className:"h-4 w-4"});case"image":return e.jsx(V,{className:"h-4 w-4"});case"logo":return e.jsx(V,{className:"h-4 w-4"});case"signature":case"stamp":return e.jsx(G,{className:"h-4 w-4"});default:return e.jsx(_,{className:"h-4 w-4"})}};return m.isLoading?e.jsx("div",{className:"p-4 text-center",children:"جاري تحميل الطبقات..."}):m.isError?e.jsx("div",{className:"p-4 text-center text-red-500",children:"حدث خطأ أثناء تحميل الطبقات"}):e.jsxs("div",{className:"border rounded-md p-4 space-y-4 bg-white",children:[e.jsx("h3",{className:"text-lg font-medium",children:"الطبقات"}),e.jsx("div",{className:"space-y-2 max-h-[500px] overflow-y-auto",children:e.jsx(he,{type:"multiple",value:f,onValueChange:y,className:"space-y-2",children:m.data&&m.data.length>0?m.data.map((a,d)=>e.jsxs(pe,{value:a.id.toString(),className:$("border p-2 rounded-md",c===a.id?"border-blue-500 bg-blue-50":"border-gray-200"),children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2 flex-1 cursor-pointer",onClick:()=>S(a),children:[s(a.type),e.jsx("span",{className:"text-sm font-medium",children:a.name})]}),e.jsxs("div",{className:"flex items-center gap-1",children:[e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>N("up",d),disabled:d===0,children:e.jsx(fe,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:()=>N("down",d),disabled:d===m.data.length-1,children:e.jsx(me,{className:"h-4 w-4"})}),e.jsx(je,{className:"h-6 w-6 p-0 hover:bg-gray-100 rounded-sm"})]})]}),e.jsxs(ge,{className:"pt-3 space-y-3",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"الاسم"}),e.jsx(q,{value:a.name,onChange:u=>L(a.id,{name:u.target.value}),className:"h-8 text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"النوع"}),e.jsxs(O,{value:a.type,onValueChange:u=>L(a.id,{type:u}),disabled:!0,children:[e.jsx(M,{className:"h-8 text-sm",children:e.jsx(Q,{})}),e.jsxs(R,{children:[e.jsx(b,{value:"field",children:"حقل نص"}),e.jsx(b,{value:"image",children:"صورة"}),e.jsx(b,{value:"logo",children:"شعار"}),e.jsx(b,{value:"signature",children:"توقيع"}),e.jsx(b,{value:"stamp",children:"ختم"})]})]})]}),a.type==="field"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"اسم الحقل"}),e.jsx(q,{value:a.fieldName||"",onChange:u=>L(a.id,{fieldName:u.target.value}),className:"h-8 text-sm"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsxs(h,{variant:"destructive",size:"sm",onClick:()=>U(a.id),className:"h-8 text-xs",children:[e.jsx(X,{className:"h-3 w-3 mr-1"}),"حذف"]})})]})]},a.id)):e.jsx("div",{className:"text-center p-4 text-gray-500 text-sm",children:"لا توجد طبقات. أضف طبقة جديدة للبدء."})})}),e.jsxs("div",{className:"pt-4 border-t space-y-3",children:[e.jsx("h4",{className:"text-sm font-medium",children:"إضافة طبقة جديدة"}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"الاسم"}),e.jsx(q,{value:g.name||"",onChange:a=>w({...g,name:a.target.value}),placeholder:"اسم الطبقة",className:"h-8 text-sm"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"النوع"}),e.jsxs(O,{value:g.type,onValueChange:a=>w({...g,type:a}),children:[e.jsx(M,{className:"h-8 text-sm",children:e.jsx(Q,{})}),e.jsxs(R,{children:[e.jsx(b,{value:"field",children:"حقل نص"}),e.jsx(b,{value:"image",children:"صورة"}),e.jsx(b,{value:"logo",children:"شعار"}),e.jsx(b,{value:"signature",children:"توقيع"}),e.jsx(b,{value:"stamp",children:"ختم"})]})]})]}),g.type==="field"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-xs font-medium",children:"اسم الحقل"}),e.jsx(q,{value:g.fieldName||"",onChange:a=>w({...g,fieldName:a.target.value}),placeholder:"اسم الحقل",className:"h-8 text-sm"})]}),e.jsx(h,{onClick:E,className:"w-full mt-2",size:"sm",disabled:n.isPending,children:n.isPending?"جارِ الإضافة...":e.jsxs(e.Fragment,{children:[e.jsx(ve,{className:"h-4 w-4 mr-1"}),"إضافة طبقة"]})})]})]})}function Ue(){const r=I(),i=K({queryKey:["/api/user/logos"],retry:1}),l=F({mutationFn:async c=>k("/api/user/logos",{method:"POST",body:c,headers:{}}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/user/logos"]})}}),o=F({mutationFn:async c=>k(`/api/user/logos/${c}`,{method:"DELETE"}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/user/logos"]})}});return{userLogos:i,uploadLogo:l,deleteLogo:o}}function Ee({onSelect:r,selectedLogoId:i}){var L,U,E,N;const{userLogos:l,uploadLogo:o,deleteLogo:c}=Ue(),{toast:m}=z(),[p,n]=v.useState(!1),[x,C]=v.useState(""),[j,f]=v.useState(!1),y=v.useRef(null),g=async s=>{var u;const a=(u=s.target.files)==null?void 0:u[0];if(!a)return;if(!a.type.startsWith("image/")){m({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"});return}if(!x.trim()){m({title:"خطأ",description:"يرجى إدخال اسم للشعار",variant:"destructive"});return}const d=new FormData;d.append("logo",a),d.append("name",x);try{f(!0),await o.mutateAsync(d),m({title:"تم الرفع",description:"تم رفع الشعار بنجاح"}),C(""),y.current&&(y.current.value="")}catch{m({title:"خطأ",description:"حدث خطأ أثناء رفع الشعار",variant:"destructive"})}finally{f(!1)}},w=async s=>{try{await c.mutateAsync(s),m({title:"تم الحذف",description:"تم حذف الشعار بنجاح"}),i===s&&r({id:0,imageUrl:""})}catch{m({title:"خطأ",description:"حدث خطأ أثناء حذف الشعار",variant:"destructive"})}},S=s=>{r(s),n(!1)};return e.jsxs(te,{open:p,onOpenChange:n,children:[e.jsx(re,{asChild:!0,children:e.jsx(h,{variant:"outline",className:"w-full h-auto p-4 border-dashed flex flex-col items-center justify-center gap-2",children:i?e.jsxs(e.Fragment,{children:[(U=(L=l.data)==null?void 0:L.find(s=>s.id===i))!=null&&U.imageUrl?e.jsx("img",{src:(N=(E=l.data)==null?void 0:E.find(s=>s.id===i))==null?void 0:N.imageUrl,alt:"الشعار المحدد",className:"w-24 h-24 object-contain"}):e.jsx(V,{className:"h-10 w-10 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"تغيير الشعار"})]}):e.jsxs(e.Fragment,{children:[e.jsx(V,{className:"h-10 w-10 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"إضافة شعار"})]})})}),e.jsxs(le,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"إختيار شعار"}),e.jsx(ce,{children:"اختر من شعاراتك الحالية أو قم برفع شعار جديد"})]}),e.jsxs(W,{defaultValue:"my-logos",className:"mt-4",children:[e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(P,{value:"my-logos",children:"شعاراتي"}),e.jsx(P,{value:"upload",children:"رفع شعار جديد"})]}),e.jsx(T,{value:"my-logos",className:"mt-4",children:l.isLoading?e.jsx("div",{className:"text-center p-8",children:"جاري التحميل..."}):l.data&&l.data.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:l.data.map(s=>e.jsxs(B,{className:$("cursor-pointer transition-all overflow-hidden",i===s.id?"ring-2 ring-blue-500":"hover:border-blue-200"),onClick:()=>S({id:s.id,imageUrl:s.imageUrl}),children:[e.jsx(H,{className:"p-4 flex justify-center items-center h-[140px]",children:e.jsx("img",{src:s.imageUrl,alt:s.name,className:"max-w-full max-h-full object-contain"})}),e.jsxs(ae,{className:"p-2 flex justify-between items-center bg-gray-50",children:[e.jsx("p",{className:"text-xs truncate",children:s.name}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:a=>{a.stopPropagation(),w(s.id)},children:e.jsx(X,{className:"h-3 w-3"})})]})]},s.id))}):e.jsx("div",{className:"text-center p-8 text-gray-500",children:"لا توجد شعارات. قم برفع شعار جديد."})}),e.jsx(T,{value:"upload",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"logo-name",className:"text-sm font-medium",children:"اسم الشعار"}),e.jsx(q,{id:"logo-name",value:x,onChange:s=>C(s.target.value),placeholder:"أدخل اسمًا للشعار"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"logo-file",className:"text-sm font-medium",children:"ملف الشعار"}),e.jsxs("div",{className:"border-2 border-dashed rounded-md p-6 flex flex-col items-center justify-center cursor-pointer",onClick:()=>{var s;return(s=y.current)==null?void 0:s.click()},children:[e.jsx(oe,{className:"h-10 w-10 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اضغط لاختيار ملف، أو اسحب وأفلت"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, JPEG or SVG (أقصى حجم: 5MB)"}),e.jsx("input",{ref:y,type:"file",id:"logo-file",accept:"image/*",className:"hidden",onChange:g})]})]}),e.jsx(h,{className:"w-full",onClick:()=>{var s;return(s=y.current)==null?void 0:s.click()},disabled:j,children:j?"جارِ الرفع...":"رفع الشعار"})]})})]}),e.jsx(de,{children:e.jsx(h,{variant:"outline",onClick:()=>n(!1),children:"إلغاء"})})]})]})}function Fe(){const r=I(),i=K({queryKey:["/api/user/signatures"],retry:1}),l=F({mutationFn:async c=>k("/api/user/signatures",{method:"POST",body:c,headers:{}}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/user/signatures"]})}}),o=F({mutationFn:async c=>k(`/api/user/signatures/${c}`,{method:"DELETE"}),onSuccess:()=>{r.invalidateQueries({queryKey:["/api/user/signatures"]})}});return{signatures:i,uploadSignature:l,deleteSignature:o}}function se({onSelect:r,selectedSignatureId:i,signatureType:l="signature"}){var s,a,d,u;const{signatures:o,uploadSignature:c,deleteSignature:m}=Fe(),{toast:p}=z(),[n,x]=v.useState(!1),[C,j]=v.useState(""),[f,y]=v.useState(l),[g,w]=v.useState(!1),S=v.useRef(null),L=async t=>{var Y;const D=(Y=t.target.files)==null?void 0:Y[0];if(!D)return;if(!D.type.startsWith("image/")){p({title:"خطأ",description:"يرجى اختيار ملف صورة صالح",variant:"destructive"});return}if(!C.trim()){p({title:"خطأ",description:"يرجى إدخال اسم للتوقيع",variant:"destructive"});return}const A=new FormData;A.append("signature",D),A.append("name",C),A.append("type",f);try{w(!0),await c.mutateAsync(A),p({title:"تم الرفع",description:f==="signature"?"تم رفع التوقيع بنجاح":"تم رفع الختم بنجاح"}),j(""),S.current&&(S.current.value="")}catch{p({title:"خطأ",description:f==="signature"?"حدث خطأ أثناء رفع التوقيع":"حدث خطأ أثناء رفع الختم",variant:"destructive"})}finally{w(!1)}},U=async t=>{try{await m.mutateAsync(t),p({title:"تم الحذف",description:l==="signature"?"تم حذف التوقيع بنجاح":"تم حذف الختم بنجاح"}),i===t&&r({id:0,imageUrl:""})}catch{p({title:"خطأ",description:l==="signature"?"حدث خطأ أثناء حذف التوقيع":"حدث خطأ أثناء حذف الختم",variant:"destructive"})}},E=t=>{r(t),x(!1)},N=l==="signature"?"توقيع":"ختم";return e.jsxs(te,{open:n,onOpenChange:x,children:[e.jsx(re,{asChild:!0,children:e.jsx(h,{variant:"outline",className:"w-full h-auto p-4 border-dashed flex flex-col items-center justify-center gap-2",children:i?e.jsxs(e.Fragment,{children:[(a=(s=o.data)==null?void 0:s.find(t=>t.id===i))!=null&&a.imageUrl?e.jsx("img",{src:(u=(d=o.data)==null?void 0:d.find(t=>t.id===i))==null?void 0:u.imageUrl,alt:l==="signature"?"التوقيع المحدد":"الختم المحدد",className:"w-24 h-24 object-contain"}):l==="signature"?e.jsx(ee,{className:"h-10 w-10 text-gray-400"}):e.jsx(G,{className:"h-10 w-10 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:["تغيير ال",N]})]}):e.jsxs(e.Fragment,{children:[l==="signature"?e.jsx(ee,{className:"h-10 w-10 text-gray-400"}):e.jsx(G,{className:"h-10 w-10 text-gray-400"}),e.jsxs("span",{className:"text-sm",children:["إضافة ",N]})]})})}),e.jsxs(le,{className:"sm:max-w-[500px]",children:[e.jsxs(ie,{children:[e.jsxs(ne,{children:["اختيار ",N]}),e.jsx(ce,{children:l==="signature"?"اختر من توقيعاتك الحالية أو قم برفع توقيع جديد":"اختر من أختامك الحالية أو قم برفع ختم جديد"})]}),e.jsxs(W,{defaultValue:"my-signatures",className:"mt-4",children:[e.jsxs(Z,{className:"grid w-full grid-cols-2",children:[e.jsx(P,{value:"my-signatures",children:l==="signature"?"توقيعاتي":"أختامي"}),e.jsx(P,{value:"upload",children:l==="signature"?"رفع توقيع جديد":"رفع ختم جديد"})]}),e.jsx(T,{value:"my-signatures",className:"mt-4",children:o.isLoading?e.jsx("div",{className:"text-center p-8",children:"جاري التحميل..."}):o.data&&o.data.length>0?e.jsx("div",{className:"grid grid-cols-2 gap-3",children:o.data.filter(t=>t.type===l).map(t=>e.jsxs(B,{className:$("cursor-pointer transition-all overflow-hidden",i===t.id?"ring-2 ring-blue-500":"hover:border-blue-200"),onClick:()=>E({id:t.id,imageUrl:t.imageUrl}),children:[e.jsx(H,{className:"p-4 flex justify-center items-center h-[140px] bg-gray-50",children:e.jsx("img",{src:t.imageUrl,alt:t.name,className:"max-w-full max-h-full object-contain"})}),e.jsxs(ae,{className:"p-2 flex justify-between items-center",children:[e.jsx("p",{className:"text-xs truncate",children:t.name}),e.jsx(h,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:D=>{D.stopPropagation(),U(t.id)},children:e.jsx(X,{className:"h-3 w-3"})})]})]},t.id))}):e.jsx("div",{className:"text-center p-8 text-gray-500",children:l==="signature"?"لا توجد توقيعات. قم برفع توقيع جديد.":"لا توجد أختام. قم برفع ختم جديد."})}),e.jsx(T,{value:"upload",className:"mt-4",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"signature-name",className:"text-sm font-medium",children:l==="signature"?"اسم التوقيع":"اسم الختم"}),e.jsx(q,{id:"signature-name",value:C,onChange:t=>j(t.target.value),placeholder:l==="signature"?"أدخل اسمًا للتوقيع":"أدخل اسمًا للختم"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"signature-type",className:"text-sm font-medium",children:"النوع"}),e.jsxs(O,{value:f,onValueChange:t=>y(t),children:[e.jsx(M,{id:"signature-type",children:e.jsx(Q,{})}),e.jsxs(R,{children:[e.jsx(b,{value:"signature",children:"توقيع"}),e.jsx(b,{value:"stamp",children:"ختم"})]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{htmlFor:"signature-file",className:"text-sm font-medium",children:f==="signature"?"ملف التوقيع":"ملف الختم"}),e.jsxs("div",{className:"border-2 border-dashed rounded-md p-6 flex flex-col items-center justify-center cursor-pointer",onClick:()=>{var t;return(t=S.current)==null?void 0:t.click()},children:[e.jsx(oe,{className:"h-10 w-10 text-gray-400 mb-2"}),e.jsx("p",{className:"text-sm text-gray-600",children:"اضغط لاختيار ملف، أو اسحب وأفلت"}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:"PNG, JPG, JPEG (خلفية شفافة مفضلة)"}),e.jsx("input",{ref:S,type:"file",id:"signature-file",accept:"image/*",className:"hidden",onChange:L})]})]}),e.jsx(h,{className:"w-full",onClick:()=>{var t;return(t=S.current)==null?void 0:t.click()},disabled:g,children:g?"جارِ الرفع...":f==="signature"?"رفع التوقيع":"رفع الختم"})]})})]}),e.jsx(de,{children:e.jsx(h,{variant:"outline",onClick:()=>x(!1),children:"إلغاء"})})]})]})}function Pe({templateId:r,templateName:i,templateImageUrl:l,initialFormData:o={},onSave:c,onBack:m}){var U,E,N;const{toast:p}=z(),[n,x]=v.useState({template:{id:r,name:i,imageUrl:l},formData:o,selectedLayerId:void 0,selectedLogo:void 0,selectedSignature:void 0,selectedStamp:void 0}),[C,j]=v.useState("layers"),f=s=>{x(a=>({...a,selectedLayerId:s.id}))},y=(s,a)=>{console.log("تحديث موضع الطبقة:",s,a)},g=s=>{x(a=>({...a,selectedLogo:s.id?s:void 0}))},w=s=>{x(a=>({...a,selectedSignature:s.id?s:void 0}))},S=s=>{x(a=>({...a,selectedStamp:s.id?s:void 0}))},L=()=>{c&&c(n),p({title:"تم الحفظ",description:"تم حفظ التعديلات بنجاح"})};return e.jsxs("div",{className:"flex flex-col h-full",children:[e.jsxs("div",{className:"bg-white border-b p-2 flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsxs(h,{variant:"ghost",size:"sm",onClick:m,children:[e.jsx(ye,{className:"h-4 w-4 ml-1"}),e.jsx("span",{children:"رجوع"})]}),e.jsx("h2",{className:"font-medium",children:i})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(Ne,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",children:e.jsx(be,{className:"h-4 w-4"})}),e.jsxs(h,{size:"sm",onClick:L,children:[e.jsx(we,{className:"h-4 w-4 ml-1"}),e.jsx("span",{children:"حفظ"})]})]})]}),e.jsxs("div",{className:"flex-1 flex",children:[e.jsx("div",{className:"w-80 border-l bg-gray-50 overflow-y-auto",children:e.jsxs(W,{value:C,onValueChange:j,children:[e.jsxs(Z,{className:"w-full grid grid-cols-3",children:[e.jsxs(P,{value:"layers",children:[e.jsx(Se,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"الطبقات"})]}),e.jsxs(P,{value:"assets",children:[e.jsx(V,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"الأصول"})]}),e.jsxs(P,{value:"settings",children:[e.jsx(ue,{className:"h-4 w-4 mr-1"}),e.jsx("span",{children:"الإعدادات"})]})]}),e.jsx(T,{value:"layers",className:"p-2",children:e.jsx(ke,{templateId:r,onSelectLayer:f,onUpdateLayerPosition:y,selectedLayerId:n.selectedLayerId})}),e.jsxs(T,{value:"assets",className:"p-4 space-y-6",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"الشعار"}),e.jsx(Ee,{onSelect:g,selectedLogoId:(U=n.selectedLogo)==null?void 0:U.id})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"التوقيع"}),e.jsx(se,{onSelect:w,selectedSignatureId:(E=n.selectedSignature)==null?void 0:E.id,signatureType:"signature"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"الختم"}),e.jsx(se,{onSelect:S,selectedSignatureId:(N=n.selectedStamp)==null?void 0:N.id,signatureType:"stamp"})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-sm font-medium mb-2",children:"صورة مخصصة"}),e.jsxs(h,{variant:"outline",className:"w-full h-auto p-4 border-dashed flex flex-col items-center justify-center gap-2",children:[e.jsx(Ce,{className:"h-10 w-10 text-gray-400"}),e.jsx("span",{className:"text-sm",children:"إضافة صورة"})]})]})]}),e.jsx(T,{value:"settings",className:"p-4",children:e.jsx(B,{children:e.jsx(H,{className:"p-4",children:e.jsx("p",{className:"text-center text-gray-500",children:"إعدادات القالب (قريبًا)"})})})})]})}),e.jsx("div",{className:"flex-1 bg-gray-100 p-0 flex items-center justify-center overflow-auto",children:e.jsxs("div",{className:"relative bg-white shadow-lg w-full h-full",style:{minHeight:"calc(100vh - 57px)"},children:[e.jsx("img",{src:l,alt:i,className:"w-full h-full object-contain absolute inset-0 z-0",style:{maxHeight:"100%",maxWidth:"100%"},onError:s=>{console.error("Error loading template image:",r),s.currentTarget.src="https://via.placeholder.com/794x1123?text=Template+Image+Not+Found"}}),n.selectedLogo&&e.jsx("div",{className:"absolute cursor-move border-2 border-transparent hover:border-blue-400",style:{top:"50px",left:"50px",width:"100px",height:"100px",zIndex:10},children:e.jsx("img",{src:n.selectedLogo.imageUrl,alt:"شعار",className:"w-full h-full object-contain",onError:s=>{console.error("Error loading logo image"),s.currentTarget.src="https://via.placeholder.com/100x100?text=Logo+Not+Found"}})}),n.selectedSignature&&e.jsx("div",{className:"absolute cursor-move border-2 border-transparent hover:border-blue-400",style:{bottom:"100px",left:"100px",width:"150px",height:"80px",zIndex:20},children:e.jsx("img",{src:n.selectedSignature.imageUrl,alt:"توقيع",className:"w-full h-full object-contain",onError:s=>{console.error("Error loading signature image"),s.currentTarget.src="https://via.placeholder.com/150x80?text=Signature+Not+Found"}})}),n.selectedStamp&&e.jsx("div",{className:"absolute cursor-move border-2 border-transparent hover:border-blue-400",style:{bottom:"120px",right:"80px",width:"120px",height:"120px",zIndex:30},children:e.jsx("img",{src:n.selectedStamp.imageUrl,alt:"ختم",className:"w-full h-full object-contain",onError:s=>{console.error("Error loading stamp image"),s.currentTarget.src="https://via.placeholder.com/120x120?text=Stamp+Not+Found"}})})]})})]})]})}function Ze(){const[,r]=xe("/template-editor/:id"),i=r!=null&&r.id?parseInt(r.id):0,{toast:l}=z();console.log("Template Editor Page - Template ID:",i);const{data:o,isLoading:c,isError:m}=K({queryKey:["/api/templates",i],queryFn:()=>k(`/api/templates/${i}`),enabled:!!i}),p=()=>{window.history.back()},n=x=>{console.log("حفظ التعديلات:",x),l({title:"تم الحفظ",description:"تم حفظ التعديلات بنجاح"})};return c?e.jsx("div",{className:"flex items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto"}),e.jsx("p",{className:"mt-4",children:"جاري تحميل القالب..."})]})}):m||!o?e.jsx("div",{className:"flex flex-col items-center justify-center min-h-screen",children:e.jsxs("div",{className:"text-center",children:[e.jsx("h2",{className:"text-2xl font-bold text-red-500 mb-2",children:"خطأ في التحميل"}),e.jsx("p",{className:"mb-4",children:"لا يمكن تحميل بيانات القالب. يرجى المحاولة مرة أخرى."}),e.jsx(h,{onClick:p,children:"العودة"})]})}):e.jsx("div",{className:"flex flex-col h-screen",children:e.jsx(Pe,{templateId:o.id,templateName:o.title,templateImageUrl:o.imageUrl,initialFormData:o.defaultValues||{},onSave:n,onBack:p})})}export{Ze as TemplateEditorPage,Ze as default};
