import{n as ne,u as ie,h as re,a as ce,r as d,b as le,i as p,j as e,C as f,s as g,t as N,v as w,d as v,B as c,c as x,ab as de,l as y,W as oe,g as me}from"./index-DoMHCGG2.js";import{I as o}from"./input-COMsjQRu.js";import{L as l}from"./label-DSWK9Bhr.js";import{S as E}from"./switch-DKvoDZdm.js";import{D as I,b as K,c as R,d as U,e as Q,f as V}from"./dialog-fsPDLJiu.js";import{T as xe,a as ue,b as q,c as O}from"./tabs-CKJmMpcu.js";import{S as B}from"./save-CRRscGsZ.js";import{T as he}from"./trash-2-Dn6YYs7e.js";/**
 * @license lucide-react v0.453.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const je=ne("KeyRound",[["path",{d:"M2.586 17.414A2 2 0 0 0 2 18.828V21a1 1 0 0 0 1 1h3a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h1a1 1 0 0 0 1-1v-1a1 1 0 0 1 1-1h.172a2 2 0 0 0 1.414-.586l.814-.814a6.5 6.5 0 1 0-4-4z",key:"1s6t7t"}],["circle",{cx:"16.5",cy:"7.5",r:".5",fill:"currentColor",key:"w0ekpg"}]]);function Ce(){const{user:a,logoutMutation:M}=ie(),{toast:i}=re(),[,H]=ce(),[z,W]=d.useState("profile"),[G,u]=d.useState(!1),[J,b]=d.useState(!1),[X,pe]=d.useState(!1),[h,Y]=d.useState({name:(a==null?void 0:a.name)||"",email:(a==null?void 0:a.email)||"",username:(a==null?void 0:a.username)||""}),[n,P]=d.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[j,Z]=d.useState({emailNotifications:!0,newCardNotifications:!0,marketingNotifications:!1}),{data:r,isLoading:_}=le({queryKey:["/api/user/stats"],queryFn:me({})}),C=p({mutationFn:async s=>(await y("PUT","/api/user/profile",s)).json(),onSuccess:()=>{oe.invalidateQueries({queryKey:["/api/user"]}),i({title:"تم تحديث الملف الشخصي بنجاح"})},onError:s=>{i({title:"فشل تحديث الملف الشخصي",description:s.message,variant:"destructive"})}}),S=p({mutationFn:async s=>(await y("PUT","/api/user/password",s)).json(),onSuccess:()=>{u(!1),P({currentPassword:"",newPassword:"",confirmPassword:""}),i({title:"تم تغيير كلمة المرور بنجاح"})},onError:s=>{i({title:"فشل تغيير كلمة المرور",description:s.message,variant:"destructive"})}}),F=p({mutationFn:async s=>(await y("PUT","/api/user/notifications",s)).json(),onSuccess:()=>{i({title:"تم تحديث إعدادات الإشعارات بنجاح"})},onError:s=>{i({title:"فشل تحديث إعدادات الإشعارات",description:s.message,variant:"destructive"})}}),D=p({mutationFn:async s=>(await y("DELETE","/api/user/account",{password:s})).json(),onSuccess:()=>{M.mutate(),H("/"),i({title:"تم حذف الحساب بنجاح"})},onError:s=>{i({title:"فشل حذف الحساب",description:s.message,variant:"destructive"})}}),k=s=>{const{name:t,value:m}=s.target;Y(A=>({...A,[t]:m}))},L=s=>{const{name:t,value:m}=s.target;P(A=>({...A,[t]:m}))},T=(s,t)=>{Z(m=>({...m,[s]:t}))},$=s=>{s.preventDefault(),C.mutate(h)},ee=s=>{if(s.preventDefault(),n.newPassword!==n.confirmPassword){i({title:"كلمات المرور غير متطابقة",description:"تأكد من تطابق كلمة المرور الجديدة وتأكيدها",variant:"destructive"});return}S.mutate({currentPassword:n.currentPassword,newPassword:n.newPassword})},se=s=>{s.preventDefault(),F.mutate(j)},ae=()=>{M.mutate()},te=_||X;return e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"الملف الشخصي"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة الملف الشخصي والإعدادات"})]})}),e.jsxs(xe,{value:z,onValueChange:W,className:"space-y-4",children:[e.jsxs(ue,{className:"grid grid-cols-3 w-full max-w-md",children:[e.jsx(q,{value:"profile",children:"الملف الشخصي"}),e.jsx(q,{value:"security",children:"الأمان"}),e.jsx(q,{value:"notifications",children:"الإشعارات"})]}),e.jsxs(O,{value:"profile",className:"space-y-4",children:[e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"المعلومات الشخصية"}),e.jsx(w,{children:"تحديث معلومات ملفك الشخصي"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:$,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"username",children:"اسم المستخدم"}),e.jsx(o,{id:"username",name:"username",value:h.username,onChange:k,readOnly:!0,disabled:!0}),e.jsx("p",{className:"text-xs text-muted-foreground",children:"لا يمكن تغيير اسم المستخدم"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"name",children:"الاسم الكامل"}),e.jsx(o,{id:"name",name:"name",value:h.name,onChange:k,placeholder:"أدخل اسمك الكامل"})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"email",children:"البريد الإلكتروني"}),e.jsx(o,{id:"email",name:"email",type:"email",value:h.email,onChange:k,placeholder:"أدخل بريدك الإلكتروني"})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{type:"submit",disabled:C.isPending,className:"min-w-[120px]",children:C.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"ml-2 h-4 w-4"}),"حفظ التغييرات"]})})})]})})]}),e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"إحصائيات الحساب"}),e.jsx(w,{children:"إحصائيات عن نشاطك في النظام"})]}),e.jsxs(v,{children:[te?e.jsx("div",{className:"flex justify-center py-4",children:e.jsx(x,{className:"h-6 w-6 animate-spin text-primary"})}):e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"البطاقات"}),e.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.totalCards)||0})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"الشهادات"}),e.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.totalCertificates)||0})]}),e.jsxs("div",{className:"bg-muted/50 p-4 rounded-lg text-center space-y-1",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"المشاهدات"}),e.jsx("p",{className:"text-3xl font-bold",children:(r==null?void 0:r.totalViews)||0})]})]}),e.jsxs("div",{className:"mt-6 pt-4 border-t",children:[e.jsxs("p",{className:"text-sm text-muted-foreground",children:["تاريخ الانضمام: ",a!=null&&a.createdAt?new Date(a.createdAt).toLocaleDateString("ar-SA"):"غير متوفر"]}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:["آخر تسجيل دخول: ",a!=null&&a.lastLogin?new Date(a.lastLogin).toLocaleDateString("ar-SA"):"غير متوفر"]})]})]})]})]}),e.jsx(O,{value:"security",className:"space-y-4",children:e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"الأمان"}),e.jsx(w,{children:"إدارة كلمة المرور وإعدادات الأمان"})]}),e.jsxs(v,{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h3",{className:"font-medium",children:"كلمة المرور"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تغيير كلمة المرور الخاصة بك"})]}),e.jsxs(c,{onClick:()=>u(!0),variant:"outline",children:[e.jsx(je,{className:"h-4 w-4 ml-2"}),"تغيير كلمة المرور"]})]}),e.jsxs("div",{className:"flex justify-between items-center pb-4 border-b",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h3",{className:"font-medium",children:"جلسات تسجيل الدخول"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"إدارة جلسات تسجيل الدخول الخاصة بك"})]}),e.jsxs(c,{onClick:ae,variant:"outline",children:[e.jsx(de,{className:"h-4 w-4 ml-2"}),"تسجيل الخروج"]})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx("h3",{className:"font-medium text-destructive",children:"حذف الحساب"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"حذف حسابك وجميع بياناتك نهائياً"})]}),e.jsxs(c,{onClick:()=>b(!0),variant:"destructive",children:[e.jsx(he,{className:"h-4 w-4 ml-2"}),"حذف الحساب"]})]})]})]})}),e.jsx(O,{value:"notifications",className:"space-y-4",children:e.jsxs(f,{children:[e.jsxs(g,{children:[e.jsx(N,{children:"إعدادات الإشعارات"}),e.jsx(w,{children:"تحكم في كيفية تلقي الإشعارات"})]}),e.jsx(v,{children:e.jsxs("form",{onSubmit:se,className:"space-y-4",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{htmlFor:"emailNotifications",children:"إشعارات البريد الإلكتروني"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تلقي جميع الإشعارات عبر البريد الإلكتروني"})]}),e.jsx(E,{id:"emailNotifications",checked:j.emailNotifications,onCheckedChange:s=>T("emailNotifications",s)})]}),e.jsxs("div",{className:"flex items-center justify-between pb-4 border-b",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{htmlFor:"newCardNotifications",children:"إشعارات البطاقات الجديدة"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"إعلامك عندما تقوم بإنشاء بطاقة جديدة"})]}),e.jsx(E,{id:"newCardNotifications",checked:j.newCardNotifications,onCheckedChange:s=>T("newCardNotifications",s)})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"space-y-0.5",children:[e.jsx(l,{htmlFor:"marketingNotifications",children:"إشعارات تسويقية"}),e.jsx("p",{className:"text-sm text-muted-foreground",children:"تلقي إشعارات حول العروض والميزات الجديدة"})]}),e.jsx(E,{id:"marketingNotifications",checked:j.marketingNotifications,onCheckedChange:s=>T("marketingNotifications",s)})]})]}),e.jsx("div",{className:"flex justify-end",children:e.jsx(c,{type:"submit",disabled:F.isPending,className:"min-w-[120px]",children:F.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحفظ..."]}):e.jsxs(e.Fragment,{children:[e.jsx(B,{className:"ml-2 h-4 w-4"}),"حفظ الإعدادات"]})})})]})})]})})]}),e.jsx(I,{open:G,onOpenChange:u,children:e.jsxs(K,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"تغيير كلمة المرور"}),e.jsx(Q,{children:"أدخل كلمة المرور الحالية وكلمة المرور الجديدة."})]}),e.jsxs("form",{onSubmit:ee,className:"space-y-4 py-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"currentPassword",children:"كلمة المرور الحالية"}),e.jsx(o,{id:"currentPassword",name:"currentPassword",type:"password",value:n.currentPassword,onChange:L,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"newPassword",children:"كلمة المرور الجديدة"}),e.jsx(o,{id:"newPassword",name:"newPassword",type:"password",value:n.newPassword,onChange:L,required:!0})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx(l,{htmlFor:"confirmPassword",children:"تأكيد كلمة المرور الجديدة"}),e.jsx(o,{id:"confirmPassword",name:"confirmPassword",type:"password",value:n.confirmPassword,onChange:L,required:!0})]}),e.jsxs(V,{children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>u(!1),children:"إلغاء"}),e.jsx(c,{type:"submit",disabled:S.isPending,children:S.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التغيير..."]}):"تغيير كلمة المرور"})]})]})]})}),e.jsx(I,{open:J,onOpenChange:b,children:e.jsxs(K,{children:[e.jsxs(R,{children:[e.jsx(U,{children:"حذف الحساب"}),e.jsx(Q,{children:"هذا الإجراء سيؤدي إلى حذف حسابك وجميع بياناتك نهائياً ولا يمكن التراجع عنه."})]}),e.jsxs("div",{className:"py-4",children:[e.jsx("p",{className:"font-medium text-destructive",children:"تحذير: سيتم حذف جميع البطاقات والشهادات الخاصة بك."}),e.jsx("p",{className:"text-sm text-muted-foreground mt-2",children:"لتأكيد الحذف، أدخل كلمة المرور الخاصة بك:"}),e.jsx(o,{className:"mt-4",type:"password",placeholder:"كلمة المرور",value:n.currentPassword,onChange:s=>P(t=>({...t,currentPassword:s.target.value}))})]}),e.jsxs(V,{children:[e.jsx(c,{variant:"outline",onClick:()=>b(!1),children:"إلغاء"}),e.jsx(c,{variant:"destructive",onClick:()=>D.mutate(n.currentPassword),disabled:D.isPending||!n.currentPassword,children:D.isPending?e.jsxs(e.Fragment,{children:[e.jsx(x,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد حذف الحساب"})]})]})})]})}export{Ce as default};
