import{o as M,a as U,h as z,r,b as A,j as e,c as m,B as i,K as P,N as B,O as K,V as x,M as V,k as y,A as _,m as H,g as J}from"./index-DoMHCGG2.js";import{S as b}from"./scroll-area-BaWF6YIt.js";import{D as C,b as D,c as S,d as k,f as G}from"./dialog-fsPDLJiu.js";import{I as W}from"./input-COMsjQRu.js";import{L as X}from"./label-DSWK9Bhr.js";import{F as Y}from"./fallback-image-BV-kt-2t.js";import{C as I}from"./chevron-left-2QWjGYBN.js";import{D as Z}from"./download-CkzZtpS5.js";import{S as ee}from"./share-2-C3FB-j83.js";import{C as T}from"./copy-DCUs-YoJ.js";import{Q as se}from"./qr-code-BYf2XRjA.js";import"./index-BdQq_4o_.js";function ue(){const{certificateId:h}=M(),[ae,o]=U(),{toast:n}=z(),[F,c]=r.useState(!1),[$,p]=r.useState(!1),[u,d]=r.useState(!1),[f,j]=r.useState(!1),[g,w]=r.useState(!1),[l,N]=r.useState(""),{data:s,isLoading:Q}=A({queryKey:[`/api/certificates/${h}`],queryFn:J({}),enabled:!!h}),O=()=>{if(s){d(!0),console.log("Downloading certificate:",s);const a=`شهادة_${s.issuedTo||s.id||"custom"}.png`;console.log(`Downloading certificate image: ${s.imageUrl}, filename: ${a}`);try{H(s.imageUrl,a),d(!1)}catch(t){console.error("Error downloading certificate:",t),n({title:"خطأ في التنزيل",description:"حدث خطأ أثناء تنزيل الشهادة. يرجى المحاولة مرة أخرى.",variant:"destructive"}),d(!1)}}},v=()=>{if(s!=null&&s.verificationCode){const a=`${window.location.origin}/certificates/verify/${s.verificationCode}`;navigator.clipboard.writeText(a),j(!0),n({title:"تم نسخ الرابط",description:"تم نسخ رابط التحقق إلى الحافظة"}),setTimeout(()=>j(!1),2e3)}},L=async a=>{if(a.preventDefault(),!(!l||!s)){w(!0);try{const t=await fetch(`/api/certificates/${s.id}/share`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:l})});if(!t.ok){const q=await t.json();throw new Error(q.message||"فشل إرسال البريد الإلكتروني")}n({title:"تم الإرسال بنجاح",description:`تم إرسال الشهادة إلى ${l}`}),c(!1),N("")}catch(t){n({title:"فشل الإرسال",description:t.message,variant:"destructive"})}finally{w(!1)}}},R=()=>{s!=null&&s.publicId&&o(`/certificate/${s.publicId}`)};if(Q)return e.jsx("div",{className:"flex justify-center items-center min-h-[60vh]",children:e.jsx(m,{className:"h-8 w-8 animate-spin text-primary"})});if(!s)return e.jsxs("div",{className:"container mx-auto py-10 text-center",children:[e.jsx("h2",{className:"text-2xl font-bold mb-4",children:"لم يتم العثور على الشهادة"}),e.jsx("p",{className:"text-muted-foreground mb-6",children:"لم نتمكن من العثور على الشهادة المطلوبة. يرجى التحقق من الرابط."}),e.jsxs(i,{onClick:()=>o("/"),children:[e.jsx(I,{className:"ml-2 h-4 w-4"}),"العودة للرئيسية"]})]});const E=`https://api.qrserver.com/v1/create-qr-code/?size=200x200&data=${encodeURIComponent(`${window.location.origin}/certificates/verify/${s.verificationCode}`)}`;return e.jsxs("div",{className:"container mx-auto py-6",children:[e.jsxs("div",{className:"max-w-5xl mx-auto",children:[e.jsxs("div",{className:"mb-6 flex justify-between items-center",children:[e.jsxs(i,{variant:"outline",size:"sm",onClick:()=>o("/"),children:[e.jsx(I,{className:"ml-2 h-4 w-4"}),"العودة للرئيسية"]}),e.jsxs("div",{className:"flex items-center space-x-3 space-x-reverse",children:[e.jsx(i,{variant:"outline",size:"sm",onClick:O,disabled:u,children:u?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري التحميل..."]}):e.jsxs(e.Fragment,{children:[e.jsx(Z,{className:"ml-2 h-4 w-4"}),"تحميل"]})}),e.jsxs(P,{children:[e.jsx(B,{asChild:!0,children:e.jsxs(i,{variant:"outline",size:"sm",children:[e.jsx(ee,{className:"ml-2 h-4 w-4"}),"مشاركة"]})}),e.jsxs(K,{align:"end",children:[e.jsxs(x,{onClick:()=>c(!0),children:[e.jsx(V,{className:"ml-2 h-4 w-4"}),"مشاركة عبر البريد الإلكتروني"]}),e.jsxs(x,{onClick:v,children:[f?e.jsx(y,{className:"ml-2 h-4 w-4 text-green-500"}):e.jsx(T,{className:"ml-2 h-4 w-4"}),"نسخ رابط التحقق"]}),e.jsxs(x,{onClick:()=>p(!0),children:[e.jsx(se,{className:"ml-2 h-4 w-4"}),"عرض رمز QR للتحقق"]})]})]})]})]}),e.jsxs("div",{className:"bg-white rounded-lg shadow-md p-6",children:[e.jsxs("div",{className:"mb-4 border-b pb-4",children:[e.jsx("h1",{className:"text-2xl font-bold",children:s.title}),e.jsxs("p",{className:"text-muted-foreground",children:[s.certificateType==="appreciation"&&"شهادة تقدير",s.certificateType==="training"&&"شهادة تدريب",s.certificateType==="education"&&"شهادة تعليم",s.certificateType==="teacher"&&"شهادة للمعلمين"]})]}),s.issuedTo&&e.jsxs("div",{className:"mb-4 text-center py-2 bg-muted/30 rounded",children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"تم إصدار هذه الشهادة إلى"}),e.jsx("p",{className:"text-lg font-medium",children:s.issuedTo})]}),e.jsx("div",{className:"aspect-[1.414/1] w-full border rounded-lg overflow-hidden mb-6",children:e.jsx(Y,{src:s.imageUrl,alt:s.title,className:"w-full h-full object-contain",fallbackSrc:"/static/default-logo.svg"})}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-between items-center bg-muted/30 p-4 rounded-lg",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-muted-foreground",children:"رمز التحقق"}),e.jsx("p",{className:"font-mono font-medium",children:s.verificationCode})]}),e.jsxs(i,{onClick:R,children:[e.jsx(_,{className:"ml-2 h-4 w-4"}),"عرض الشهادة كاملة"]})]})]})]}),e.jsx(C,{open:F,onOpenChange:c,children:e.jsxs(D,{className:"max-h-[90vh]",children:[e.jsx(S,{children:e.jsx(k,{children:"مشاركة عبر البريد الإلكتروني"})}),e.jsx(b,{className:"max-h-[calc(90vh-160px)]",children:e.jsxs("form",{onSubmit:L,children:[e.jsx("div",{className:"space-y-4 py-4",children:e.jsxs("div",{className:"space-y-2",children:[e.jsx(X,{htmlFor:"email",children:"عنوان البريد الإلكتروني"}),e.jsx(W,{id:"email",type:"email",placeholder:"أدخل عنوان البريد الإلكتروني",value:l,onChange:a=>N(a.target.value),required:!0})]})}),e.jsx(G,{children:e.jsx(i,{type:"submit",disabled:g,children:g?e.jsxs(e.Fragment,{children:[e.jsx(m,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الإرسال..."]}):"إرسال"})})]})})]})}),e.jsx(C,{open:$,onOpenChange:p,children:e.jsxs(D,{className:"text-center max-h-[90vh]",children:[e.jsx(S,{children:e.jsx(k,{children:"رمز QR للتحقق"})}),e.jsxs(b,{className:"max-h-[calc(90vh-160px)]",children:[e.jsx("div",{className:"py-6 flex justify-center",children:e.jsx("img",{src:E,alt:"QR Code",className:"max-w-full"})}),e.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"يمكن استخدام رمز QR للتحقق من صحة الشهادة"}),e.jsx(i,{variant:"outline",onClick:v,children:f?e.jsxs(e.Fragment,{children:[e.jsx(y,{className:"ml-2 h-4 w-4 text-green-500"}),"تم النسخ!"]}):e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"ml-2 h-4 w-4"}),"نسخ رابط التحقق"]})})]})]})})]})}export{ue as default};
