import{u as Fe,h as ke,a as Le,r as i,b as $,g as q,i as Ie,j as e,B as t,L as g,U as Pe,c as N,C as ae,F as S,d as re,A as F,X as Ae,k as Ee,M as te,l as ie,m as le}from"./index-DoMHCGG2.js";import{I as Te}from"./input-COMsjQRu.js";import{T as ze,a as Ue,b as ce,c as ne}from"./tabs-CKJmMpcu.js";import{C as De,W as Q,R as $e,E as qe,G as Qe,a as Re}from"./ramadan-form-BGgFOXsp.js";import{S as Ge}from"./share-options-Dq3pJXip.js";import{S as Me,a as He,b as Oe,c as We,d as k}from"./select-CRu623qS.js";import{S as Ke}from"./search-CdLD-xpV.js";import{E as Ve}from"./eye-Co1cENxs.js";import{D as oe}from"./download-CkzZtpS5.js";import{R as Be}from"./refresh-cw-sltvKsd-.js";import{P as de,S as me,F as _e,H as Xe}from"./sparkles-BkoZyrB3.js";import{G as Je}from"./graduation-cap-CdGFpJUx.js";import"./label-DSWK9Bhr.js";import"./textarea-C01GBzJv.js";import"./radio-group-CNTqitTj.js";import"./checkbox-Da8DgAL4.js";import"./scroll-area-BaWF6YIt.js";import"./index-BdQq_4o_.js";import"./dialog-fsPDLJiu.js";import"./image-CRCqvbIG.js";import"./twitter-BkFCnlyo.js";import"./instagram-BWPAtAad.js";import"./share-2-C3FB-j83.js";import"./qr-code-BYf2XRjA.js";import"./copy-DCUs-YoJ.js";import"./chevron-up-DgjV3eGa.js";function Cs(){const{user:L}=Fe(),{toast:l}=ke(),[R,G]=Le(),[m,ue]=i.useState(""),[u,I]=i.useState("all"),[P,M]=i.useState("cards"),[a,H]=i.useState(null),[w,A]=i.useState({}),[d,y]=i.useState(null),[E,T]=i.useState(null),[x,z]=i.useState(!1),[O,he]=i.useState(!1),[W,xe]=i.useState("high");i.useEffect(()=>{const s=new URLSearchParams(R.split("?")[1]),r=s.get("category"),c=s.get("tab");r&&I(r),c==="certificates"&&M("certificates")},[R]);const{data:U,isLoading:K}=$({queryKey:["/api/categories"],queryFn:q()}),{data:f,isLoading:ge}=$({queryKey:[u==="all"?"/api/templates":`/api/categories/${u}/templates`],queryFn:q()}),{data:v,isLoading:fe}=$({queryKey:[`/api/template-fields/${a==null?void 0:a.id}`],queryFn:q(),enabled:!!(a!=null&&a.id)}),b=Ie({mutationFn:async s=>{var r;return ie("POST","/api/cards/generate",{templateId:a.id,category:((r=a.category)==null?void 0:r.slug)||"other",formData:w,quality:s,isPreview:!1})},onSuccess:(s,r)=>{if(s&&s.imageUrl){const c=`بطاقة-${(a==null?void 0:a.title)||"مخصصة"}-${r}.png`;le(s.imageUrl,c),l({title:"تم التنزيل بنجاح",description:`تم تنزيل البطاقة بجودة ${r==="high"?"عالية":r==="medium"?"متوسطة":r==="low"?"منخفضة":"ممتازة"}`})}},onError:()=>{ve()}}),V=Array.isArray(f)?f:(f==null?void 0:f.templates)||[],je=V.filter(s=>!s.certificateType||s.certificateType==="card"),pe=V.filter(s=>s.certificateType&&s.certificateType!=="card");i.useEffect(()=>{const s=new URLSearchParams;u!=="all"&&s.set("category",u),P==="certificates"&&s.set("tab","certificates");const r=s.toString();G(r?`/?${r}`:"/",{replace:!0})},[u,P,G]);const B=je.filter(s=>!m||s.title.toLowerCase().includes(m.toLowerCase())||s.titleAr&&s.titleAr.toLowerCase().includes(m.toLowerCase())),_=pe.filter(s=>!m||s.title.toLowerCase().includes(m.toLowerCase())||s.titleAr&&s.titleAr.toLowerCase().includes(m.toLowerCase())),Ne=s=>{switch(s){case"wedding":return e.jsx(Xe,{className:"h-5 w-5"});case"graduation":return e.jsx(Je,{className:"h-5 w-5"});case"birthday":return e.jsx(de,{className:"h-5 w-5"});case"eid":return e.jsx(me,{className:"h-5 w-5"});case"ramadan":return e.jsx(_e,{className:"h-5 w-5"});case"invitation":return e.jsx(te,{className:"h-5 w-5"});case"certificates":return e.jsx(F,{className:"h-5 w-5"});default:return e.jsx(S,{className:"h-5 w-5"})}},X=s=>{A(s)},J=s=>{H(s),A({}),y(null),T(null)},we=()=>{H(null),A({}),y(null),T(null)},ye=async s=>{var r,c,ee;s.preventDefault();try{if(!a){l({title:"خطأ",description:"يرجى اختيار قالب أولًا",variant:"destructive"});return}z(!0),l({title:"جاري الإنشاء...",description:"يتم الآن إنشاء صورة المعاينة، يرجى الانتظار"});const D=Object.entries(w).some(([n,o])=>typeof o=="string"&&o.startsWith("data:image/"));try{let n;const o=((r=a.category)==null?void 0:r.slug)||"other",se=a.id;if(D){const h=new FormData;h.append("templateId",se),h.append("category",o),h.append("quality","preview"),h.append("isPreview","true");for(const[p,C]of Object.entries(w))if(typeof C=="string"&&C.startsWith("data:image/")){const Ce=await fetch(C).then(Se=>Se.blob());h.append(p,Ce,`${p}.jpg`)}else h.append(p,String(C));n=await fetch("/api/cards/generate",{method:"POST",body:h}).then(p=>p.json())}else n=await ie("POST","/api/cards/generate",{templateId:se,category:o,formData:w,quality:"preview",isPreview:!0},{timeout:2e4});const j=n;if(console.log("Card preview created successfully:",j),!j.cardId){console.error("API response missing cardId:",j),l({title:"خطأ",description:"تم إنشاء البطاقة ولكن تعذر الحصول على معرف البطاقة",variant:"destructive"}),z(!1);return}T(j.cardId),y(j.imageUrl),l({title:"تم بنجاح",description:"تم إنشاء المعاينة بنجاح"})}catch(n){console.error("API Error:",n);let o="حدث خطأ أثناء إنشاء المعاينة، يرجى المحاولة مرة أخرى";(c=n.message)!=null&&c.includes("timeout")||n.name==="AbortError"?o="استغرق الطلب وقتا طويلا. تحقق من اتصالك بالإنترنت وحاول مرة أخرى.":(ee=n.message)!=null&&ee.includes("القالب غير موجود")&&(o="القالب المحدد غير متوفر، يرجى اختيار قالب آخر."),l({title:"خطأ",description:o,variant:"destructive"})}}catch(D){console.error("General Error:",D),l({title:"خطأ",description:"حدث خطأ غير متوقع، يرجى المحاولة مرة أخرى",variant:"destructive"})}finally{z(!1)}},ve=()=>{if(d)try{const s=`بطاقة-${(a==null?void 0:a.title)||"مخصصة"}.png`;le(d,s),l({title:"تم التنزيل",description:"تم تنزيل النسخة المتاحة من البطاقة"})}catch(s){console.error("Fallback download error:",s),l({title:"خطأ",description:"تعذر تنزيل البطاقة، يرجى المحاولة مرة أخرى",variant:"destructive"})}else l({title:"خطأ",description:"لا توجد صورة متاحة للتنزيل",variant:"destructive"})},Y=()=>{!E||!(a!=null&&a.id)||(O?b.mutate(W):(b.mutate("high"),he(!0)))},be=()=>{var c;if(fe)return e.jsx("div",{className:"p-6 text-center",children:"جاري تحميل القالب..."});if(v&&Array.isArray(v)&&v.length>0)return e.jsx(De,{onChange:X,template:{...a,templateFields:v}});let s;switch(((c=a==null?void 0:a.category)==null?void 0:c.slug)||"other"){case"wedding":s=Q;break;case"engagement":s=Re;break;case"graduation":s=Qe;break;case"eid":s=qe;break;case"ramadan":s=$e;break;case"other":s=Q;break;default:s=Q}return s?e.jsx(s,{onChange:X,template:a}):e.jsx("div",{className:"p-6 text-center",children:"نوع البطاقة غير مدعوم. الرجاء العودة واختيار قالب آخر."})},Z=K||ge;return e.jsxs("div",{className:"container mx-auto py-6 space-y-8",children:[e.jsxs("section",{className:"text-center space-y-6 py-10",children:[e.jsx("h1",{className:"text-4xl font-bold tracking-tight",children:"أنشئ بطاقات وشهادات مخصصة بتصاميم احترافية"}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-3xl mx-auto",children:"اختر من بين مجموعة واسعة من القوالب وقم بتخصيصها حسب احتياجاتك"}),e.jsxs("div",{className:"relative max-w-md mx-auto",children:[e.jsx(Ke,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(Te,{placeholder:"ابحث عن قوالب...",className:"pr-9",value:m,onChange:s=>ue(s.target.value)})]}),L?e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(t,{asChild:!0,children:e.jsxs(g,{href:"/user/dashboard",children:[e.jsx(Pe,{className:"h-4 w-4 ml-2"}),"لوحة التحكم"]})}),e.jsx(t,{variant:"outline",asChild:!0,children:e.jsx(g,{href:"/user/cards",children:"عرض بطاقاتي"})})]}):e.jsxs("div",{className:"flex items-center justify-center gap-4",children:[e.jsx(t,{asChild:!0,children:e.jsx(g,{href:"/auth",children:"تسجيل الدخول"})}),e.jsx(t,{variant:"outline",asChild:!0,children:e.jsx(g,{href:"/auth?tab=register",children:"إنشاء حساب"})})]})]}),e.jsx("section",{children:e.jsx("div",{className:"flex overflow-x-auto pb-4 scrollbar-thin scrollbar-thumb-muted-foreground/20 scrollbar-track-transparent",children:e.jsxs("div",{className:"flex gap-2",children:[e.jsx(t,{variant:u==="all"?"default":"outline",size:"sm",onClick:()=>I("all"),className:"whitespace-nowrap",children:"جميع القوالب"}),!K&&(U==null?void 0:U.map(s=>e.jsxs(t,{variant:u===s.slug?"default":"outline",size:"sm",onClick:()=>I(s.slug),className:"whitespace-nowrap",children:[Ne(s.slug),e.jsx("span",{className:"mr-2",children:s.name})]},s.id)))]})})}),e.jsx("section",{children:e.jsxs(ze,{value:P,onValueChange:M,children:[e.jsx("div",{className:"flex justify-between items-center mb-6",children:e.jsxs(Ue,{children:[e.jsx(ce,{value:"cards",children:"بطاقات"}),e.jsx(ce,{value:"certificates",children:"شهادات"})]})}),e.jsx(ne,{value:"cards",className:"mt-0",children:Z?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):B.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:B.map(s=>e.jsxs(ae,{className:`overflow-hidden group hover:shadow-md transition-shadow cursor-pointer ${(a==null?void 0:a.id)===s.id?"ring-2 ring-primary":""}`,onClick:()=>J(s),children:[e.jsx("div",{className:"aspect-square w-full overflow-hidden bg-muted",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-contain group-hover:scale-105 transition-transform duration-300",loading:"lazy",onError:r=>{console.error("Error loading template image:",s.id),r.currentTarget.onerror=null,r.currentTarget.src="/static/placeholder-card.svg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(S,{className:"h-16 w-16"})})}),e.jsxs(re,{className:"p-4",children:[e.jsx("h3",{className:"font-medium",children:s.title}),s.titleAr&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.titleAr})]})]},s.id))}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx(S,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد قوالب متطابقة"}),e.jsx("p",{className:"text-muted-foreground",children:"لم نتمكن من العثور على قوالب تطابق معايير البحث"})]})}),e.jsx(ne,{value:"certificates",className:"mt-0",children:Z?e.jsx("div",{className:"flex justify-center py-20",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):_.length>0?e.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-6",children:_.map(s=>e.jsxs(ae,{className:`overflow-hidden group hover:shadow-md transition-shadow cursor-pointer ${(a==null?void 0:a.id)===s.id?"ring-2 ring-primary":""}`,onClick:()=>J(s),children:[e.jsx("div",{className:"aspect-square w-full overflow-hidden bg-muted",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:s.title,className:"w-full h-full object-contain group-hover:scale-105 transition-transform duration-300",loading:"lazy",onError:r=>{console.error("Error loading certificate template image:",s.id),r.currentTarget.onerror=null,r.currentTarget.src="/static/placeholder-certificate.svg"}}):e.jsx("div",{className:"w-full h-full flex items-center justify-center text-muted-foreground",children:e.jsx(F,{className:"h-16 w-16"})})}),e.jsxs(re,{className:"p-4",children:[e.jsx("h3",{className:"font-medium",children:s.title}),s.titleAr&&e.jsx("p",{className:"text-sm text-muted-foreground",children:s.titleAr}),e.jsxs("p",{className:"text-sm text-muted-foreground mt-1",children:[s.certificateType==="appreciation"&&"شهادة تقدير",s.certificateType==="training"&&"شهادة تدريب",s.certificateType==="education"&&"شهادة تعليم",s.certificateType==="teacher"&&"شهادة للمعلمين"]})]})]},s.id))}):e.jsxs("div",{className:"text-center py-20",children:[e.jsx(F,{className:"h-16 w-16 mx-auto text-muted-foreground mb-4"}),e.jsx("h3",{className:"text-lg font-medium mb-2",children:"لا توجد قوالب متطابقة"}),e.jsx("p",{className:"text-muted-foreground",children:"لم نتمكن من العثور على قوالب تطابق معايير البحث"})]})})]})}),a&&e.jsxs("section",{className:"bg-muted/30 p-6 rounded-lg mt-8 relative",children:[e.jsx(t,{variant:"ghost",size:"icon",className:"absolute top-2 left-2",onClick:we,children:e.jsx(Ae,{className:"h-4 w-4"})}),e.jsx("h2",{className:"text-2xl font-bold mb-6",children:a.title}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-8",children:[e.jsxs("div",{className:"space-y-6",children:[e.jsxs("h3",{className:"text-xl font-medium mb-4",children:["تخصيص ",a.title]}),e.jsxs("form",{onSubmit:ye,className:"space-y-6",children:[be(),e.jsx("div",{className:"pt-4",children:e.jsx(t,{type:"submit",className:"w-full px-6 py-3 bg-primary text-white font-medium rounded-md hover:bg-primary/90 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 transition-colors",disabled:x,children:x?e.jsxs(e.Fragment,{children:[e.jsx(N,{className:"mr-2 h-4 w-4 animate-spin"}),"جاري المعالجة..."]}):"معاينة البطاقة"})})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsx("h3",{className:"text-xl font-medium mb-4",children:"معاينة البطاقة"}),e.jsx("div",{className:"bg-white p-4 rounded-lg shadow-md",children:e.jsx("div",{className:"relative pb-[140%]",children:x?e.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:e.jsx(N,{className:"h-8 w-8 animate-spin text-primary"})}):d?e.jsx("img",{src:d,alt:"Preview",className:"absolute inset-0 w-full h-full object-contain"}):e.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-muted-foreground",children:e.jsxs("div",{className:"text-center",children:[e.jsx(S,{className:"h-16 w-16 mx-auto mb-2"}),e.jsx("p",{children:"قم بتعبئة النموذج وانقر على معاينة البطاقة لعرض المعاينة"})]})})})}),d&&e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsxs("div",{className:"flex gap-2 justify-between items-center",children:[e.jsxs(t,{variant:"default",onClick:()=>window.open(d,"_blank"),size:"sm",className:"flex-1",children:[e.jsx(Ve,{className:"h-4 w-4 ml-2"}),"عرض"]}),O?e.jsxs("div",{className:"flex items-center gap-1 flex-1",children:[e.jsxs(Me,{value:W,onValueChange:s=>xe(s),children:[e.jsx(He,{className:"h-9 w-28 text-xs",children:e.jsx(Oe,{placeholder:"اختر الجودة"})}),e.jsxs(We,{children:[e.jsx(k,{value:"low",children:"منخفضة"}),e.jsx(k,{value:"medium",children:"متوسطة"}),e.jsx(k,{value:"high",children:"عالية"}),e.jsx(k,{value:"download",children:"ممتازة"})]})]}),e.jsxs(t,{variant:"secondary",onClick:Y,disabled:b.isPending,size:"sm",children:[b.isPending?e.jsx(N,{className:"h-4 w-4 animate-spin"}):e.jsx(oe,{className:"h-4 w-4"}),"تنزيل"]})]}):e.jsxs(t,{variant:"secondary",onClick:Y,className:"flex items-center gap-1 flex-1",disabled:!d&&!E,size:"sm",children:[e.jsx(oe,{className:"h-4 w-4"}),"تنزيل"]}),e.jsx(Ge,{cardId:E||"",imageUrl:d||"",size:"sm",templateId:a==null?void 0:a.id})]}),L?e.jsxs(t,{variant:"outline",className:"w-full",disabled:x,children:[e.jsx(Ee,{className:"mr-2 h-4 w-4"}),"حفظ إلى حسابي"]}):e.jsx(t,{variant:"outline",className:"w-full",disabled:x,asChild:!0,children:e.jsx(g,{href:"/auth",children:"تسجيل الدخول لحفظ البطاقة"})}),e.jsxs(t,{variant:"ghost",className:"w-full",onClick:()=>y(null),disabled:x,children:[e.jsx(Be,{className:"mr-2 h-4 w-4"}),"إعادة المعاينة"]})]})]})]})]}),e.jsxs("section",{className:"py-10",children:[e.jsx("h2",{className:"text-3xl font-bold text-center mb-12",children:"مميزاتنا"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[e.jsxs("div",{className:"bg-muted/40 rounded-lg p-6 text-center space-y-4",children:[e.jsx("div",{className:"bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto",children:e.jsx(de,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-medium",children:"تصاميم مخصصة"}),e.jsx("p",{className:"text-muted-foreground",children:"أضف نصوصك وصورك وخصص التصميم حسب ذوقك"})]}),e.jsxs("div",{className:"bg-muted/40 rounded-lg p-6 text-center space-y-4",children:[e.jsx("div",{className:"bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto",children:e.jsx(F,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-medium",children:"شهادات موثقة"}),e.jsx("p",{className:"text-muted-foreground",children:"إنشاء شهادات مع رموز تحقق فريدة وقابلة للتحقق"})]}),e.jsxs("div",{className:"bg-muted/40 rounded-lg p-6 text-center space-y-4",children:[e.jsx("div",{className:"bg-primary/10 w-16 h-16 rounded-full flex items-center justify-center mx-auto",children:e.jsx(te,{className:"h-8 w-8 text-primary"})}),e.jsx("h3",{className:"text-xl font-medium",children:"مشاركة سهلة"}),e.jsx("p",{className:"text-muted-foreground",children:"شارك تصاميمك بسهولة عبر وسائل التواصل الاجتماعي والبريد الإلكتروني"})]})]})]}),e.jsxs("section",{className:"bg-muted/30 py-16 px-6 rounded-lg text-center space-y-6",children:[e.jsx("h2",{className:"text-3xl font-bold",children:"جاهز لإنشاء تصميمك الأول؟"}),e.jsx("p",{className:"text-xl text-muted-foreground max-w-2xl mx-auto",children:"ابدأ الآن واستكشف مجموعة واسعة من القوالب المصممة لمختلف المناسبات"}),e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[!a&&e.jsx(t,{size:"lg",asChild:!0,children:e.jsxs("a",{href:"#templates",children:[e.jsx(me,{className:"h-5 w-5 ml-2"}),"استكشاف القوالب"]})}),!L&&e.jsx(t,{size:"lg",variant:"outline",asChild:!0,children:e.jsx(g,{href:"/auth",children:"إنشاء حساب"})})]})]})]})}export{Cs as default};
