import{h as O,r as i,b as D,i as $,j as e,c as T,C as z,s as B,t as R,v as Y,d as Z,U as _,K as G,N as J,B as d,O as W,P as X,Q as F,V as M,L as ee,Y as se,Z as ae,_ as E}from"./index-DoMHCGG2.js";import{I as te}from"./input-COMsjQRu.js";import{D as le,b as re,c as ie,d as ne,e as ce,f as de}from"./dialog-fsPDLJiu.js";import{S as L,a as q,b as I,c as k,d as n}from"./select-CRu623qS.js";import{T as oe,a as xe,b as A,c as a,d as me,e as t}from"./table-I-YXpiuN.js";import{S as he}from"./search-CdLD-xpV.js";import{F as ue}from"./filter-7iR-QHWX.js";import{F as je}from"./file-image-CUREGKCZ.js";import{E as pe}from"./ellipsis-vertical-CjI7CaMN.js";import{E as ge}from"./eye-Co1cENxs.js";import{T as fe}from"./trash-2-Dn6YYs7e.js";import"./index-BdQq_4o_.js";import"./chevron-up-DgjV3eGa.js";function Ie(){const{toast:v}=O(),[j,P]=i.useState(""),[o,Q]=i.useState("all"),[x,K]=i.useState("all"),[U,m]=i.useState(!1),[h,N]=i.useState(null),[l,w]=i.useState(1),c=20,{data:r,isLoading:V,isFetching:y}=D({queryKey:["/api/admin/cards",l,c,o,x,j],queryFn:()=>E({})({queryKey:["/api/admin/cards"],meta:{params:{page:l,limit:c,status:o!=="all"?o:void 0,category:x!=="all"?x:void 0,search:j||void 0}}})}),{data:p,isLoading:ve}=D({queryKey:["/api/categories"],queryFn:E({})}),g=$({mutationFn:async s=>{await se("DELETE",`/api/admin/cards/${s}`)},onSuccess:()=>{ae.invalidateQueries({queryKey:["/api/admin/cards"]}),m(!1),N(null),v({title:"تم حذف البطاقة بنجاح"})},onError:s=>{v({title:"فشل حذف البطاقة",description:s.message,variant:"destructive"})}}),H=s=>{N(s),m(!0)},C=(r==null?void 0:r.cards)||[],u=(r==null?void 0:r.total)||0,f=Math.ceil(u/c);return V?e.jsx("div",{className:"container mx-auto py-10 flex justify-center",children:e.jsx(T,{className:"h-8 w-8 animate-spin text-primary"})}):e.jsxs("div",{className:"container mx-auto py-6 space-y-6",children:[e.jsx("div",{className:"flex justify-between items-center",children:e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold",children:"البطاقات"}),e.jsx("p",{className:"text-muted-foreground",children:"إدارة البطاقات المنشأة في النظام"})]})}),e.jsxs("div",{className:"flex flex-col md:flex-row gap-4 md:items-center md:justify-between",children:[e.jsxs("div",{className:"relative flex-1 max-w-sm",children:[e.jsx(he,{className:"absolute right-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),e.jsx(te,{placeholder:"البحث في البطاقات...",className:"pr-9",value:j,onChange:s=>P(s.target.value)})]}),e.jsxs("div",{className:"flex flex-wrap gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-2 space-x-reverse",children:[e.jsx(ue,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs(L,{value:x,onValueChange:K,children:[e.jsx(q,{className:"w-[160px]",children:e.jsx(I,{placeholder:"جميع التصنيفات"})}),e.jsxs(k,{children:[e.jsx(n,{value:"all",children:"جميع التصنيفات"}),p==null?void 0:p.map(s=>e.jsx(n,{value:s.slug,children:s.name},s.id))]})]})]}),e.jsx("div",{className:"flex items-center space-x-2 space-x-reverse",children:e.jsxs(L,{value:o,onValueChange:Q,children:[e.jsx(q,{className:"w-[160px]",children:e.jsx(I,{placeholder:"حالة البطاقة"})}),e.jsxs(k,{children:[e.jsx(n,{value:"all",children:"جميع الحالات"}),e.jsx(n,{value:"active",children:"نشطة"}),e.jsx(n,{value:"draft",children:"مسودة"}),e.jsx(n,{value:"deleted",children:"محذوفة"})]})]})})]})]}),e.jsxs(z,{children:[e.jsxs(B,{className:"pb-3",children:[e.jsx(R,{children:"البطاقات"}),e.jsxs(Y,{children:["عدد البطاقات: ",u]})]}),e.jsx(Z,{children:C.length?e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"border rounded-md overflow-hidden",children:e.jsxs(oe,{children:[e.jsx(xe,{children:e.jsxs(A,{children:[e.jsx(a,{className:"w-16",children:"الصورة"}),e.jsx(a,{children:"العنوان"}),e.jsx(a,{children:"التصنيف"}),e.jsx(a,{children:"المستخدم"}),e.jsx(a,{className:"text-center",children:"المشاهدات"}),e.jsx(a,{className:"text-center",children:"تاريخ الإنشاء"}),e.jsx(a,{className:"text-center",children:"آخر وصول"}),e.jsx(a,{className:"text-center",children:"الحالة"}),e.jsx(a,{className:"w-12"})]})}),e.jsx(me,{children:C.map(s=>{var b,S;return e.jsxs(A,{children:[e.jsx(t,{children:e.jsx("div",{className:"w-12 h-12 rounded-md overflow-hidden bg-muted",children:s.imageUrl?e.jsx("img",{src:s.imageUrl,alt:"البطاقة",className:"w-full h-full object-cover"}):e.jsx("div",{className:"flex items-center justify-center w-full h-full text-muted-foreground",children:e.jsx(je,{className:"h-5 w-5"})})})}),e.jsxs(t,{children:[e.jsx("div",{className:"font-medium",children:((b=s.template)==null?void 0:b.title)||`بطاقة ${s.id}`}),e.jsx("code",{className:"text-xs bg-muted px-1 py-0.5 rounded",children:s.publicId})]}),e.jsx(t,{children:((S=s.category)==null?void 0:S.name)||"غير معروف"}),e.jsx(t,{children:s.user?e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(_,{className:"h-4 w-4 text-muted-foreground"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:s.user.username}),e.jsx("div",{className:"text-xs text-muted-foreground",children:s.user.email})]})]}):e.jsx("span",{className:"text-muted-foreground",children:"زائر"})}),e.jsx(t,{className:"text-center",children:s.accessCount}),e.jsx(t,{className:"text-center",children:new Date(s.createdAt).toLocaleDateString("ar-SA")}),e.jsx(t,{className:"text-center",children:s.lastAccessed?new Date(s.lastAccessed).toLocaleDateString("ar-SA"):"-"}),e.jsx(t,{className:"text-center",children:e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${s.status==="active"?"bg-green-100 text-green-800":s.status==="draft"?"bg-yellow-100 text-yellow-800":"bg-gray-100 text-gray-800"}`,children:s.status==="active"?"نشطة":s.status==="draft"?"مسودة":s.status==="deleted"?"محذوفة":s.status})}),e.jsx(t,{children:e.jsxs(G,{children:[e.jsx(J,{asChild:!0,children:e.jsx(d,{variant:"ghost",size:"icon",children:e.jsx(pe,{className:"h-4 w-4"})})}),e.jsxs(W,{align:"end",children:[e.jsx(X,{children:"خيارات"}),e.jsx(F,{}),e.jsx(M,{asChild:!0,children:e.jsxs(ee,{href:`/view/${s.publicId}`,children:[e.jsx(ge,{className:"h-4 w-4 ml-2"}),"عرض البطاقة"]})}),e.jsx(F,{}),e.jsxs(M,{onClick:()=>H(s),className:"text-destructive focus:text-destructive",children:[e.jsx(fe,{className:"h-4 w-4 ml-2"}),"حذف"]})]})]})})]},s.id)})})]})}),f>1&&e.jsxs("div",{className:"flex items-center justify-between mt-6",children:[e.jsxs("div",{className:"text-sm text-muted-foreground",children:["عرض ",(l-1)*c+1," - ",Math.min(l*c,u)," من ",u]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(d,{variant:"outline",size:"sm",onClick:()=>w(s=>Math.max(s-1,1)),disabled:l===1||y,children:"السابق"}),e.jsx(d,{variant:"outline",size:"sm",onClick:()=>w(s=>Math.min(s+1,f)),disabled:l===f||y,children:"التالي"})]})]})]}):e.jsx("div",{className:"text-center py-10 text-muted-foreground",children:"لا توجد بطاقات متطابقة مع معايير البحث"})})]}),e.jsx(le,{open:U,onOpenChange:m,children:e.jsxs(re,{children:[e.jsxs(ie,{children:[e.jsx(ne,{children:"حذف البطاقة"}),e.jsx(ce,{children:"هل أنت متأكد من رغبتك في حذف هذه البطاقة؟ هذا الإجراء لا يمكن التراجع عنه."})]}),e.jsxs("div",{className:"py-4",children:[h&&e.jsx("div",{className:"aspect-video w-[200px] h-[120px] mx-auto overflow-hidden rounded-md border",children:e.jsx("img",{src:h.imageUrl,alt:"البطاقة",className:"w-full h-full object-cover"})}),e.jsx("p",{className:"text-sm text-muted-foreground mt-6 text-center",children:"سيتم حذف البطاقة نهائياً ولن تتمكن من استعادتها."})]}),e.jsxs(de,{children:[e.jsx(d,{variant:"outline",onClick:()=>m(!1),children:"إلغاء"}),e.jsx(d,{variant:"destructive",onClick:()=>h&&g.mutate(h.id),disabled:g.isPending,children:g.isPending?e.jsxs(e.Fragment,{children:[e.jsx(T,{className:"ml-2 h-4 w-4 animate-spin"}),"جاري الحذف..."]}):"تأكيد الحذف"})]})]})})]})}export{Ie as default};
